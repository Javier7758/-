<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è·¨å¹´æ—…è¡Œ | æœ¬åœ°å„²å­˜ç‰ˆ (æ¥µç°¡)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .tab-active { color: #ff0000; border-bottom: 2px solid #ff0000; }
        .fa-solid { margin-right: 5px; } 
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="app" class="max-w-md mx-auto min-h-screen pb-20 relative shadow-2xl bg-white">
        
        <header class="bg-slate-900 text-white p-6 rounded-b-3xl shadow-lg">
            <h1 class="text-2xl font-bold italic">è·¨å¹´æ—…è¡Œ <span class="text-orange-500">2026</span></h1>
            <p class="text-sm opacity-75">æ•¸æ“šå·²å„²å­˜æ–¼æ‚¨çš„è£ç½®ï¼Œç„¡éœ€ç™»å…¥</p>
        </header>
        
        <nav class="flex justify-around bg-white border-b sticky top-0 z-10 text-slate-400 font-medium">
            <button @click="currentTab = 'itinerary'" :class="{'tab-active': currentTab === 'itinerary'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-calendar-days block text-lg mb-1"></i>è¡Œç¨‹</button>
            <button @click="currentTab = 'landmarks'" :class="{'tab-active': currentTab === 'landmarks'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-camera block text-lg mb-1"></i>æ™¯é»</button>
            <button @click="currentTab = 'finance'" :class="{'tab-active': currentTab === 'finance'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-wallet block text-lg mb-1"></i>è¨˜å¸³</button>
            <button @click="currentTab = 'wishlist'" :class="{'tab-active': currentTab === 'wishlist'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-gift block text-lg mb-1"></i>é¡˜æœ›</button>
            
            <a href="https://www.gbaweather.net/tc/" target="_blank" class="py-4 flex-1 text-sm flex flex-col items-center justify-center text-slate-400 hover:text-orange-500 transition duration-150">
                <i class="fa-solid fa-cloud-sun block text-lg mb-1"></i>
                å¤©æ°£
            </a>
        </nav>

        <main class="p-4">
            
            <section v-if="currentTab === 'itinerary'" class="space-y-4">
                <div v-for="day in schedule" :key="day.id" class="border-l-4 border-orange-500 pl-4 py-2 relative bg-white rounded-r-xl p-3 shadow-md hover:shadow-lg transition">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-900">{{ day.date }}</span>
                        <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ day.tag }}</span>
                    </div>
                    <p class="text-sm text-slate-600">{{ day.desc }}</p>
                </div>
            </section>

            <section v-if="currentTab === 'landmarks'" class="space-y-4">
                <div v-for="item in landmarks" :key="item.id" class="p-4 border rounded-2xl flex flex-col bg-white shadow-sm hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-bold text-slate-900">{{ item.name }}</h3>
                            <p class="text-xs text-orange-600">{{ item.type }}</p>
                        </div>
                        <a :href="'http://googleusercontent.com/maps.google.com/search?q=' + item.name + '+é¦™æ¸¯'" target="_blank" class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full hover:bg-slate-200">å°èˆª <i class="fa-solid fa-location-arrow ml-1"></i></a>
                    </div>
                    <p class="text-sm text-slate-600 mb-3">{{ item.desc }}</p>
                </div>
            </section>

            <section v-if="currentTab === 'finance'">
                
                <div class="bg-slate-200 p-4 rounded-2xl mb-4 shadow-inner">
                    <h3 class="font-bold text-slate-800 mb-2 flex justify-between items-center">
                        åŒ¯ç‡è¨ˆç®—æ©Ÿ (TWD) <i class="fa-solid fa-calculator"></i>
                    </h3>
                    <div class="flex gap-2 mb-3">
                        <input v-model.number="calculator.amount" type="number" placeholder="è¼¸å…¥é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        <select v-model="calculator.currency" class="p-3 border rounded-xl text-sm bg-white">
                            <option value="HKD">HKD (æ¸¯å¹£ 1:4)</option>
                            <option value="RMB">RMB (äººæ°‘å¹£ 1:4.4)</option>
                        </select>
                    </div>
                    <p v-if="calculator.amount > 0" class="text-center text-lg font-bold text-orange-700">
                        = ${{ calculatedTWD.toFixed(2) }} TWD
                    </p>
                    <p v-else class="text-center text-sm text-slate-500">
                        è«‹è¼¸å…¥é‡‘é¡ä»¥é–‹å§‹è¨ˆç®—
                    </p>
                </div>
                <div @click="openStatsModal" class="bg-slate-900 text-white p-4 rounded-2xl mb-4 shadow-lg cursor-pointer transition duration-150 hover:bg-slate-800">
                    <p class="text-xs opacity-70 flex justify-between items-center">
                        ç¸½æ”¯å‡º (TWD)
                        <i class="fa-solid fa-chart-pie text-base"></i>
                    </p>
                    <p class="text-2xl font-bold">TWD ${{ totalExpenseTWD.toFixed(0) }}</p>
                </div>

                <div class="space-y-2 mb-6 p-4 border border-dashed rounded-xl bg-orange-50">
                    <h4 class="font-bold text-slate-800 mb-2">æ–°å¢æ”¯å‡ºé …ç›®</h4>
                    
                    <div class="w-full">
                        <div v-if="newExpense.category === 'äº¤é€š' && newExpense.item !== 'å…¶ä»–äº¤é€š'">
                            <select v-model="newExpense.item" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="">è«‹é¸æ“‡äº¤é€šæ–¹å¼ (éå¿…å¡«)</option>
                                <option value="å·´å£«"><i class="fa-solid fa-bus"></i> å·´å£«</option>
                                <option value="åœ°éµ"><i class="fa-solid fa-train-subway"></i> åœ°éµ</option>
                                <option value="çš„å£«"><i class="fa-solid fa-taxi"></i> çš„å£«</option>
                                <option value="å…¶ä»–äº¤é€š"><i class="fa-solid fa-road"></i> å…¶ä»–</option>
                            </select>
                        </div>
                        <div v-else-if="newExpense.category === 'äº¤é€š' && newExpense.item === 'å…¶ä»–äº¤é€š'">
                             <input v-model="newExpense.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div v-else>
                            <input v-model="newExpense.item" placeholder="ç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                         <select v-model="newExpense.category" class="flex-1 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                            <option value="åƒ"><i class="fa-solid fa-utensils"></i> åƒ</option>
                            <option value="äº¤é€š"><i class="fa-solid fa-bus"></i> äº¤é€š</option>
                            <option value="è³¼ç‰©"><i class="fa-solid fa-bag-shopping"></i> è³¼ç‰©</option>
                            <option value="é–€ç¥¨"><i class="fa-solid fa-ticket"></i> é–€ç¥¨</option>
                            <option value="å…¶ä»–"><i class="fa-solid fa-ellipsis-h"></i> å…¶ä»–</option>
                        </select>
                        <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        <select v-model="newExpense.currency" class="w-20 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                            <option value="HKD">HKD</option>
                            <option value="RMB">RMB</option>
                            <option value="TWD">TWD</option>
                        </select>
                    </div>

                    <select v-model="newExpense.method" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                        <option value="ç¾é‡‘"><i class="fa-solid fa-money-bill-wave"></i> ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡"><i class="fa-solid fa-credit-card"></i> ä¿¡ç”¨å¡</option>
                        <option value="å…«é”é€š"><i class="fa-solid fa-train"></i> å…«é”é€š</option>
                        <option value="é›»å­æ”¯ä»˜"><i class="fa-solid fa-qrcode"></i> é›»å­æ”¯ä»˜</option>
                        <option value="å…¶ä»–"><i class="fa-solid fa-ellipsis-h"></i> å…¶ä»–</option>
                    </select>
                    <button @click="addExpense" :disabled="!newExpense.amount" class="w-full bg-orange-500 disabled:opacity-50 text-white p-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢æ”¯å‡º</button>
                </div>

                <div v-for="(exp, index) in expenses" :key="exp.id" class="p-3 border-b border-slate-200 hover:bg-slate-50 transition duration-100">
                    <div v-if="!exp.isEditing" class="flex justify-between items-start text-sm">
                        <div class="flex-1">
                            <span class="font-bold text-slate-800">{{ exp.item }}</span>
                            <small class="text-slate-400 block">{{ getCategoryLabel(exp.category) }} ({{ exp.method }})</small>
                        </div>
                        <div class="text-right">
                            <span class="font-medium text-red-500 text-base block">- {{ exp.currency }} {{ exp.amount }}</span>
                            <span v-if="exp.currency !== 'TWD'" class="text-xs text-slate-500">
                                (ç´„ TWD {{ convertToTWD(exp.amount, exp.currency).toFixed(0) }})
                            </span>
                            <div class="flex justify-end gap-3 pt-1 mt-1">
                                <button @click="toggleEdit(exp)" class="text-xs text-blue-500 hover:text-blue-700 font-medium"><i class="fa-solid fa-edit mr-1"></i>ç·¨è¼¯</button>
                                <button @click="deleteExpense(exp.id)" class="text-xs text-red-500 hover:text-red-700 font-medium"><i class="fa-solid fa-trash-alt mr-1"></i>åˆªé™¤</button>
                            </div>
                        </div>
                    </div>

                    <div v-else class="p-2 bg-white rounded-lg border border-blue-300">
                         <h4 class="font-bold text-sm mb-2 text-blue-600">ç·¨è¼¯æ”¯å‡º</h4>
                         
                         <div v-if="exp.category === 'äº¤é€š' && exp.item === 'å…¶ä»–äº¤é€š'">
                            <input v-model="exp.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                         </div>
                         <div v-else-if="exp.category === 'äº¤é€š'">
                            <select v-model="exp.item" class="w-full p-2 border rounded-lg text-sm mb-2 bg-white focus:ring-blue-500 focus:border-blue-500">
                                <option value="å·´å£«">å·´å£«</option>
                                <option value="åœ°éµ">åœ°éµ</option>
                                <option value="çš„å£«">çš„å£«</option>
                                <option value="å…¶ä»–äº¤é€š">å…¶ä»–</option>
                            </select>
                         </div>
                         <div v-else>
                            <input v-model="exp.item" placeholder="ç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                         </div>

                         <div class="flex gap-2 mb-2">
                            <select v-model="exp.category" class="flex-1 p-2 border rounded-lg text-sm bg-white">
                                <option value="åƒ">åƒ</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="è³¼ç‰©">è³¼ç‰©</option>
                                <option value="é–€ç¥¨">é–€ç¥¨</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <input v-model.number="exp.amount" type="number" placeholder="é‡‘é¡" class="w-1/3 p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                             <select v-model="exp.currency" class="w-1/4 p-2 border rounded-lg text-sm bg-white">
                                <option value="HKD">HKD</option>
                                <option value="RMB">RMB</option>
                                <option value="TWD">TWD</option>
                            </select>
                         </div>
                         <select v-model="exp.method" class="w-full p-2 border rounded-lg text-sm mb-3 bg-white">
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                            <option value="å…«é”é€š">å…«é”é€š</option>
                            <option value="é›»å­æ”¯ä»˜">é›»å­æ”¯ä»˜</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                         </select>

                         <button @click="toggleEdit(exp)" class="w-full bg-blue-600 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                             å„²å­˜ä¿®æ”¹ <i class="fa-solid fa-save ml-1"></i>
                         </button>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'wishlist'" class="space-y-4">
                <div class="mb-4">
                    <select v-model="selectedMember" class="w-full p-3 border border-orange-300 rounded-xl text-sm font-bold bg-white shadow-md focus:ring-2 focus:ring-orange-500">
                        <option value="å…¨éƒ¨">æ‰€æœ‰äºº (é¡¯ç¤ºæ‰€æœ‰é¡˜æœ›)</option>
                        <option v-for="member in members" :key="member" :value="member">{{ member }}</option>
                    </select>
                </div>

                <div class="flex gap-2 mb-6">
                    <select v-model="newWishItem.member" class="p-3 border rounded-xl text-sm bg-white font-medium">
                        <option v-for="member in members" :key="member + '_add'" :value="member">{{ member }}</option>
                    </select>
                    <input v-model="newWishItem.item" @keyup.enter="addWishItem" placeholder="æƒ³è²·ä»€éº¼..." class="flex-1 p-3 border rounded-lg text-sm focus:ring-orange-500 focus:border-orange-500">
                    <button @click="addWishItem" class="bg-slate-900 text-white px-4 rounded-xl active:scale-95 transition"><i class="fa-solid fa-plus"></i></button>
                </div>

                <div v-if="filteredWishlist.length > 0" class="space-y-2">
                    <div v-for="(item, index) in filteredWishlist" :key="item.id" class="flex items-center p-3 bg-slate-50 rounded-xl justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" v-model="item.done" class="mr-3 w-5 h-5 accent-orange-500">
                            <span :class="{'line-through text-slate-400': item.done}" class="text-sm font-medium">{{ item.item }}</span>
                        </div>
                        <span v-if="selectedMember === 'å…¨éƒ¨'" class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ item.member }}</span>
                        
                        <button @click="deleteWishItem(item.id)" class="ml-3 text-red-500 hover:text-red-700">
                            <i class="fa-solid fa-times text-xs"></i>
                        </button>
                    </div>
                </div>
                <div v-else class="text-center text-slate-500 p-8 border border-dashed rounded-xl">
                    <i class="fa-solid fa-face-frown text-2xl mb-2"></i>
                    <p>{{ selectedMember }} çš„é¡˜æœ›æ¸…å–®æ˜¯ç©ºçš„ï¼</p>
                </div>
            </section>

        </main>
        
        <div class="bg-red-600 text-white p-3 shadow-xl absolute bottom-0 w-full">
            <p class="font-bold text-lg mb-1 flex items-center">
                <i class="fa-solid fa-triangle-exclamation mr-2 text-yellow-300"></i> ç·Šæ€¥æ±‚åŠ©é›»è©±
            </p>
            <div class="flex justify-around text-sm font-medium">
                <a href="tel:999" class="text-center hover:bg-red-700 p-1 rounded-md transition duration-150">
                    ğŸ‡­ğŸ‡° é¦™æ¸¯ï¼š<span class="font-black text-xl">999</span>
                </a>
                <a href="tel:110" class="text-center hover:bg-red-700 p-1 rounded-md transition duration-150">
                    ğŸ‡¨ğŸ‡³ ä¸­åœ‹ï¼š<span class="font-black text-xl">110 / 120 / 119</span>
                </a>
            </div>
        </div>
        <div v-if="isStatsModalOpen" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex justify-center items-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-sm">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-xl font-bold text-slate-800">æ”¯å‡ºåˆ†æ (TWD)</h3>
                    <button @click="isStatsModalOpen = false" class="text-gray-500 hover:text-gray-800">
                        <i class="fa-solid fa-times text-lg"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="w-full h-64 flex justify-center">
                        <canvas id="expenseChart"></canvas>
                    </div>

                    <h4 class="font-bold text-sm text-orange-600 mt-4">ç¸½æ”¯å‡º TWD ${{ totalExpenseTWD.toFixed(0) }}</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div v-for="(amount, category) in categoryTotals" :key="category" class="flex justify-between border-b pb-1">
                            <span>{{ category }}</span>
                            <span class="font-medium text-slate-700">TWD {{ amount.toFixed(0) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
<script>
    const { createApp, ref, computed, watch, nextTick } = Vue;

    // --- Local Storage åŠ©æ‰‹å‡½å¼ï¼šè®€å–èˆ‡å„²å­˜é€šç”¨é‚è¼¯ ---

    function loadData(key, defaultData = []) {
        try {
            const stored = localStorage.getItem(key);
            const data = stored ? JSON.parse(stored) : defaultData;
            
            if (key === 'hk_trip_expenses') {
                return data.map(item => ({ 
                    id: item.id || Date.now() + Math.random(), 
                    category: item.category || 'å…¶ä»–', 
                    isEditing: item.isEditing || false, 
                    item: item.item || '', 
                    ...item 
                }));
            }
            return data;
        } catch (e) {
            console.error(`ç„¡æ³•å¾ Local Storage è®€å–è³‡æ–™: ${key}`, e);
            return defaultData;
        }
    }

    function saveData(key, list) {
        const cleanedList = list.map(({ isEditing, ...rest }) => rest);
        localStorage.setItem(key, JSON.stringify(cleanedList));
    }


    // -------------------------------------------------------
    // Vue App å•Ÿå‹•å‰çš„æ•¸æ“šè™•ç† 
    // -------------------------------------------------------

    // ğŸš© æ•¸æ“šä¿®æ”¹å€ï¼šè¡Œç¨‹èˆ‡æ™¯é» ğŸš©
    const FIXED_SCHEDULE = [
        { id: 1, date: '12/25', tag: 'å•Ÿç¨‹', desc: 'æŠµæ¸¯ã€check-in é¦™æ¸¯å®¶ã€æ—ºè§’æ™šé¤' },
        { id: 2, date: '12/26', tag: 'å¸‚å€', desc: 'ä¸­ç’°å¤§é¤¨ã€çŸ³æ¿è¡—ã€å±±é ‚çºœè»Š' },
        { id: 3, date: '12/27', tag: 'éƒŠéŠ', desc: 'å¤§å¶¼å±±å¤©å£‡å¤§ä½›ã€å¤§æ¾³æ¼æ‘' },
        { id: 4, date: '01/01', tag: 'åŒ¯åˆ', desc: 'åˆ°æ©Ÿå ´æ¥çˆ¸åª½ & å¼Ÿå¼Ÿã€å°–æ²™å’€æµ·æ—' },
        { id: 5, date: '01/02', tag: 'åœ˜é«”', desc: 'é¦™æ¸¯è¿ªå£«å°¼æ¨‚åœ’å…¨æ—¥éŠ' },
        { id: 6, date: '01/04', tag: 'å›ç¨‹', desc: 'é€æ©Ÿã€è‡ªç”±æ´»å‹•' }
    ];
    
    const FIXED_LANDMARKS = [
        { id: 1, name: 'é¦™æ¸¯åœ‹éš›æ©Ÿå ´', type: 'äº¤é€šæ¨ç´', desc: 'ä½œç‚ºå…¥å¢ƒå’Œå‡ºå¢ƒé»' },
        { id: 2, name: 'é¦™æ¸¯è¿ªå£«å°¼æ¨‚åœ’', type: 'éŠæ¨‚æ™¯é»', desc: 'æ³¨æ„é–‹åœ’æ™‚é–“ï¼Œæå‰è¨‚ç¥¨' },
        { id: 3, name: 'ä¸­ç’°å¤§é¤¨', type: 'æ–‡åŒ–è—è¡“', desc: 'ä¸­ç’°å€çš„æ­·å²å»ºç¯‰ç¾¤ï¼Œæ‹ç…§å¾ˆå¥½çœ‹' },
        { id: 4, name: 'å¤ªå¹³å±±é ‚', type: 'è‡ªç„¶æ™¯è§€', desc: 'å¤œæ™¯æœ€ä½³è§€è³é»ï¼Œæ’éšŠæ™‚é–“é•·' }
    ];
    
    const FIXED_MEMBERS = ['çˆ¸çˆ¸', 'åª½åª½', 'æ©å®œ', 'æŸå‘ˆ', 'å”æ²›'];
    
    const defaultExpenses = []; 
    const defaultWishlist = [{ id: 1, member: 'æ©å®œ', item: 'å°ç†Šç¶­å°¼å…¬ä»”', done: false }];

    const initialExpenses = loadData('hk_trip_expenses', defaultExpenses);
    const initialWishlist = loadData('hk_trip_wishlist', defaultWishlist);

    let nextExpenseId = (initialExpenses.length > 0 ? Math.max(...initialExpenses.map(e => e.id)) : 0) + 1;
    let nextWishId = (initialWishlist.length > 0 ? Math.max(...initialWishlist.map(w => w.id)) : 0) + 1;

    // ğŸš© æ ¸å¿ƒåŒ¯ç‡å¸¸é‡ ğŸš©
    const RMB_RATE = 4.4; 
    const HKD_RATE = 4.0;
    
    // å®šç¾©åœ–è¡¨é¡è‰² (Chart.js é¡è‰²é…ç½®)
    const CHART_COLORS = [
        '#FF6384', 
        '#36A2EB', 
        '#FFCD56', 
        '#4BC0C0', 
        '#9966FF', 
        '#FF9F40'
    ];
    
    let expenseChartInstance = null;


    createApp({
        setup() {
            const currentTab = ref('itinerary'); 
            const isStatsModalOpen = ref(false); 
            
            // --- æ•¸æ“šçµæ§‹ (Ref) ---
            const schedule = ref(FIXED_SCHEDULE);
            const landmarks = ref(FIXED_LANDMARKS);
            const expenses = ref(initialExpenses);
            const newExpense = ref({ 
                item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒ' 
            });
            const members = FIXED_MEMBERS;
            const wishlist = ref(initialWishlist);
            const selectedMember = ref('å…¨éƒ¨'); 
            const newWishItem = ref({ member: 'æ©å®œ', item: '' }); 
            const calculator = ref({ amount: null, currency: 'HKD' });


            // =======================================================
            // ğŸš© æ ¸å¿ƒé‚è¼¯å€ ğŸš©
            // =======================================================
            
            // ğŸ’° åŒ¯ç‡è½‰æ›å‡½å¼ (å¾ä»»ä½•å¹£åˆ¥è½‰ TWD)
            function convertToTWD(amount, currency) {
                amount = Number(amount) || 0;
                switch (currency) {
                    case 'RMB': return amount * RMB_RATE; 
                    case 'HKD': return amount * HKD_RATE; 
                    case 'TWD': return amount; 
                    default: return 0;
                }
            }
            
            // è¼”åŠ©å‡½å¼ï¼šæ ¹æ“š category ä»£ç¢¼ç²å–æ˜“è®€æ¨™ç±¤
            function getCategoryLabel(category) {
                if (!category) return 'ğŸ’¡ å…¶ä»–'; 
                
                switch (category) {
                    case 'åƒ': return 'ğŸ½ï¸ åƒ';
                    case 'äº¤é€š': return 'ğŸšŒ äº¤é€š';
                    case 'è³¼ç‰©': return 'ğŸ›ï¸ è³¼ç‰©';
                    case 'é–€ç¥¨': return 'ğŸŸï¸ é–€ç¥¨';
                    default: return 'ğŸ’¡ å…¶ä»–';
                }
            }


            // ğŸ’° åŒ¯ç‡è¨ˆç®—å±¬æ€§ (çµ¦ä¸Šæ–¹è¨ˆç®—æ©Ÿä½¿ç”¨)
            const calculatedTWD = computed(() => {
                return convertToTWD(calculator.value.amount, calculator.value.currency);
            });
            

            // --- è¨˜å¸³ CRUD ---
            
            // ğŸ¯ è¨ˆç®—å„åˆ†é¡ç¸½æ”¯å‡º (Computed Property)
            const categoryTotals = computed(() => {
                const totals = { 'åƒ': 0, 'äº¤é€š': 0, 'è³¼ç‰©': 0, 'é–€ç¥¨': 0, 'å…¶ä»–': 0 };
                
                expenses.value.forEach(exp => {
                    const twdAmount = convertToTWD(exp.amount, exp.currency);
                    const mainCategoryKey = exp.category || 'å…¶ä»–'; 
                    
                    if (totals.hasOwnProperty(mainCategoryKey)) {
                        totals[mainCategoryKey] += twdAmount;
                    } else {
                        totals['å…¶ä»–'] += twdAmount;
                    }
                });
                return totals;
            });

            // è¨ˆç®—ç¸½æ”¯å‡º (Computed Property) - TWD ç¸½é¡
            const totalExpenseTWD = computed(() => {
                return expenses.value.reduce((total, exp) => {
                    return total + convertToTWD(exp.amount, exp.currency);
                }, 0);
            });
            
            // æ–°å¢æ”¯å‡ºå‡½å¼
            function addExpense() {
                // åƒ…æª¢æŸ¥é‡‘é¡æ˜¯å¦å¡«å¯«
                if (newExpense.value.amount) {
                    expenses.value.unshift({ 
                        ...newExpense.value, 
                        id: nextExpenseId++,
                        isEditing: false,
                        // è™•ç†ç°¡è¿°ï¼šå¦‚æœ item ç‚ºç©ºå­—ä¸²ï¼Œå°‡å…¶æ›¿æ›ç‚ºé¡åˆ¥åç¨±
                        item: newExpense.value.item || newExpense.value.category
                    });
                    
                    // é‡è¨­è¡¨å–®
                    newExpense.value = { item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒ' };
                }
            }

            // ç·¨è¼¯/å„²å­˜åˆ‡æ›å‡½å¼
            function toggleEdit(item) { 
                item.isEditing = !item.isEditing; 
                // å¦‚æœæ˜¯å„²å­˜å‹•ä½œï¼Œç¢ºä¿ item ä¸ç‚ºç©º (çµ¦äºˆé¡åˆ¥åç¨±ä½œç‚ºé è¨­å€¼)
                if (!item.isEditing && !item.item) {
                     item.item = item.category;
                }
            }

            // åˆªé™¤æ”¯å‡ºå‡½å¼
            function deleteExpense(id) {
                expenses.value = expenses.value.filter(exp => exp.id !== id);
            }

            // ğŸŒŸ åœ“é¤…åœ–ç¹ªè£½é‚è¼¯ ğŸŒŸ
            function renderChart() {
                if (expenseChartInstance) {
                    expenseChartInstance.destroy(); 
                }

                const ctx = document.getElementById('expenseChart').getContext('2d');
                const totals = categoryTotals.value;
                
                const labels = Object.keys(totals).filter(key => totals[key] > 0);
                const data = labels.map(key => totals[key]);

                expenseChartInstance = new Chart(ctx, {
                    type: 'doughnut', 
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: CHART_COLORS.slice(0, labels.length),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: TWD ${value.toFixed(0)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // ğŸŒŸ æ‰“é–‹çµ±è¨ˆå½ˆçª—ä¸¦ç¹ªè£½åœ–è¡¨ ğŸŒŸ
            function openStatsModal() {
                isStatsModalOpen.value = true;
                nextTick(() => {
                    renderChart();
                });
            }
            
            // ğŸŒŸ ç›£è½æ–°æ”¯å‡ºé¡åˆ¥åˆ‡æ›ï¼Œæ¸…ç©ºç°¡è¿°ä»¥é¿å…æ®˜ç•™
            watch(() => newExpense.value.category, (newCategory) => {
                newExpense.value.item = ''; 
            });


            // --- é¡˜æœ›æ¸…å–® CRUD (ä¿æŒä¸è®Š) ---
            
            const filteredWishlist = computed(() => {
                if (selectedMember.value === 'å…¨éƒ¨') {
                    return [...wishlist.value].sort((a, b) => members.indexOf(a.member) - members.indexOf(b.member));
                }
                return wishlist.value.filter(item => item.member === selectedMember.value);
            });
            
            function addWishItem() {
                if (newWishItem.value.item && newWishItem.value.member) {
                    wishlist.value.push({ 
                        id: nextWishId++,
                        member: newWishItem.value.member,
                        item: newWishItem.value.item, 
                        done: false 
                    });
                    newWishItem.value.item = ''; 
                    selectedMember.value = newWishItem.value.member;
                }
            }
            
            function deleteWishItem(id) {
                wishlist.value = wishlist.value.filter(item => item.id !== id);
            }
            
            // =======================================================
            // ğŸš© æ•¸æ“šè®Šå‹•ç›£è½å™¨ï¼šè‡ªå‹•å„²å­˜åˆ° Local Storage ğŸš©
            // =======================================================

            const watchOptions = { deep: true };
            watch(expenses, (newList) => saveData('hk_trip_expenses', newList), watchOptions);
            watch(wishlist, (newList) => saveData('hk_trip_wishlist', newList), watchOptions);


            return { 
                currentTab, 
                isStatsModalOpen, 
                openStatsModal, 
                // è¡Œç¨‹ & æ™¯é» (åªè®€ - ä¾†è‡ª FIXED_*)
                schedule, 
                landmarks,
                // è¨˜å¸³
                expenses, newExpense, totalExpenseTWD, categoryTotals, addExpense, deleteExpense, toggleEdit, getCategoryLabel, convertToTWD,
                // åŒ¯ç‡è¨ˆç®—
                calculator, calculatedTWD,
                // é¡˜æœ›æ¸…å–®
                members, selectedMember, wishlist, filteredWishlist, newWishItem, addWishItem, deleteWishItem
            };
        }
    }).mount('#app');
</script>
</body>
</html>