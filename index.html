<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è·¨å¹´æ—…è¡Œ | æœ¬åœ°å„²å­˜ç‰ˆ (æ¥µç°¡)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .tab-active { color: #ff0000; border-bottom: 2px solid #ff0000; }
        .fa-solid { margin-right: 5px; } 

        /* ã€é¦™æ¸¯èƒŒæ™¯ï¼šç´«è‰²ç³»ã€‘ */
        .card-bg-HK { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), 
            url('https://dummyimage.com/600x80/6a0dad/ffffff&text=Hong+Kong'); /* ç´«è‰² */
            background-size: cover; 
            background-position: center;
        }
        
        /* æ·±åœ³èƒŒæ™¯ï¼šç¶ è‰²ç³» */
        .card-bg-SZ { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), url('https://dummyimage.com/600x80/004d40/ffffff&text=Shenzhen'); /* æ·±ç¶ è‰² */
            background-size: cover; 
            background-position: center;
        }

        /* ã€å»£å·èƒŒæ™¯ï¼šè—è‰²ç³»ã€‘ */
        .card-bg-GZ { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), url('https://dummyimage.com/600x80/1a73e8/ffffff&text=Guangzhou'); /* è—è‰² */
            background-size: cover; 
            background-position: center;
        }

        .card-bg-default {
            background-color: #374151; /* slate-700 fallback */
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            text-align: right;
            margin-left: auto;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="app" class="max-w-md mx-auto min-h-screen pb-4 relative shadow-2xl bg-white">
        
        <header class="bg-slate-900 text-white p-6 rounded-b-3xl shadow-lg">
            <h1 class="text-2xl font-bold italic">è·¨å¹´æ—…è¡Œ <span class="text-orange-500">2026</span></h1>
            <p class="text-sm opacity-75">æ•¸æ“šå·²å„²å­˜æ–¼æ‚¨çš„è£ç½®ï¼Œç„¡éœ€ç™»å…¥</p>
        </header>
        
        <nav class="flex justify-around bg-white border-b sticky top-0 z-10 text-slate-400 font-medium">
            <button @click="currentTab = 'itinerary'" :class="{'tab-active': currentTab === 'itinerary'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-calendar-days block text-lg mb-1"></i>è¡Œç¨‹</button>
            <button @click="currentTab = 'finance'" :class="{'tab-active': currentTab === 'finance'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-wallet block text-lg mb-1"></i>è¨˜å¸³</button>
            <button @click="currentTab = 'wishlist'" :class="{'tab-active': currentTab === 'wishlist'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-gift block text-lg mb-1"></i>é¡˜æœ›</button>
            
            <a href="https://www.gbaweather.net/tc/" target="_blank" class="py-4 flex-1 text-sm flex flex-col items-center justify-center text-slate-400 hover:text-orange-500 transition duration-150">
                <i class="fa-solid fa-cloud-sun block text-lg mb-1"></i>
                å¤©æ°£
            </a>
            
            <button @click="currentTab = 'essentials'" :class="{'tab-active': currentTab === 'essentials'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-bell block text-lg mb-1"></i>é‡è¦è³‡è¨Š</button>
        </nav>

        <main class="p-4">
            
            <section v-if="currentTab === 'itinerary'" class="space-y-4">
                
                <div class="bg-slate-200 p-4 rounded-2xl mb-4 shadow-inner">
                    <h3 class="font-bold text-slate-800 mb-2 flex justify-between items-center">
                        åŒ¯ç‡è¨ˆç®—æ©Ÿ (TWD) <i class="fa-solid fa-calculator"></i>
                    </h3>
                    <div class="flex gap-2 mb-3">
                        <input v-model.number="calculator.amount" type="number" placeholder="è¼¸å…¥é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        <select v-model="calculator.currency" class="p-3 border rounded-xl text-sm bg-white">
                            <option value="HKD">HKD (æ¸¯å¹£1:4)</option>
                            <option value="RMB">RMB (äººæ°‘å¹£1:4.4)</option>
                        </select>
                    </div>
                    <p v-if="calculator.amount > 0" class="text-center text-lg font-bold text-orange-700">
                        = ${{ calculatedTWD.toFixed(2) }} TWD
                    </p>
                    <p v-else class="text-center text-sm text-slate-500">
                        è«‹è¼¸å…¥é‡‘é¡ä»¥é–‹å§‹è¨ˆç®—
                    </p>
                </div>
                <div v-for="day in schedule" :key="day.id" class="bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 hover:shadow-xl">
                    
                    <div :class="`card-bg-${day.city_code}`"
                         class="h-16 w-full flex justify-between items-center p-3 text-white">
                        
                        <span class="text-xl font-extrabold tracking-wider">{{ day.city }}</span>
                        
                        <div class="weather-info">
                            <i :class="getWeatherIcon(day.weather)" class="fa-solid mr-1 text-yellow-300 text-lg"></i>
                            <div class="flex flex-col items-end leading-none">
                                <span class="font-bold text-sm">{{ day.weather }}</span>
                                <span class="text-xs opacity-90">{{ day.temp }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-3 border-l-4 border-orange-500 bg-white">
                        <span class="text-lg font-extrabold text-slate-800 block mb-1">{{ day.date }}</span>
                        <p class="text-sm text-slate-700">{{ day.desc }}</p>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'essentials'" class="space-y-6">
                
               <div class="bg-green-50 p-4 rounded-xl shadow-md border-l-4 border-green-500">
    <h3 class="font-bold text-green-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-plane-departure mr-2"></i> èˆªç­è³‡è¨Š</h3>
    <div class="space-y-2 text-sm">
        <a href="https://booking.evaair.com/flyeva/eva/b2c/manage-your-trip/online-checked-in-login.aspx" target="_blank" class="font-bold text-blue-700 hover:text-blue-500 hover:underline transition duration-150 block">
            æŒ‰æ­¤æ–¼èµ·é£›å‰48è‡³1å°æ™‚è¾¦ç†ç¶²ä¸Šå ±åˆ°
        </a>
        <hr class="border-green-300">
        <p><span class="font-semibold text-slate-900">å»ç¨‹ (é•·æ¦®BR867):</span> 2026/01/01 (09:50 - 11:50)</p>
        <p><span class="font-semibold text-slate-900">å›ç¨‹ (é•·æ¦®BR868):</span> 2026/01/04 (13:30 - 15:20)</p>
    </div>
</div>

                <div class="bg-blue-50 p-4 rounded-xl shadow-md border-l-4 border-blue-500">
    <h3 class="font-bold text-blue-800 text-lg mb-3 flex items-center"><i class="fa-solid fa-house-user mr-2"></i> ä½å®¿åœ°å€</h3>

    <div class="mb-4 pb-3 border-b border-blue-200">
        <p class="font-bold text-base text-slate-900 mb-1">ğŸ‡¨ğŸ‡³ æ·±åœ³</p>
        
        <a href="https://tw.trip.com/hotels/shenzhen-hotel-detail-41520773/bangtuo-meinuo-executive-apartment/" target="_blank" class="font-bold text-orange-600 hover:text-orange-500 hover:underline transition duration-150 text-base block">
            é‚¦æ‹“ç¾è«¾è¡Œæ”¿å…¬å¯“ï¼ˆæ·±åœ³å‰æµ·å»£å ´åº—ï¼‰
        </a>
        
        <p class="text-xs text-slate-600 mt-1">
            å—å±±å€, æœˆäº®ç£å¤§é“1104è™Ÿä½³å…†æ¥­å‰æµ·å»£å ´äºŒæœŸBåº§5æ¨“506å®¤
        </p>
    
    </div>

    <div>
        <p class="font-bold text-base text-slate-900 mb-1">ğŸ‡­ğŸ‡° é¦™æ¸¯</p>
        
        <a href="https://tw.trip.com/hotels/hong-kong-hotel-detail-7114825/camlux-hotel/" target="_blank" class="font-bold text-orange-600 hover:text-orange-500 hover:underline transition duration-150 text-base block">
            é¦™æ¸¯å›ç«‹é£¯åº—
        </a>
        
        <p class="text-xs text-slate-600 mt-1">
            è§€å¡˜å€, ä¹é¾ç£å®å…‰é“15è™Ÿ
        </p>
        <a href="https://www.google.com/maps/place/%E5%90%9B%E7%AB%8B%E9%85%92%E5%BA%97/@22.3237639,114.2034422,17z/data=!3m1!4b1!4m9!3m8!1s0x34040132e4727759:0xaefe60d32380705b!5m2!4m1!1i2!8m2!3d22.3237639!4d114.2060171!16s%2Fg%2F11c5s98sdf?entry=ttu&g_ep=EgoyMDI1MTIwMi4wIKXMDSoASAFQAw%3D%3D" target="_blank" class="text-xs text-blue-600 font-semibold hover:underline mt-1 inline-block">åœ¨ Google åœ°åœ–ä¸ŠæŸ¥çœ‹ <i class="fa-solid fa-location-dot ml-1"></i></a>
    </div>
</div>

               <div class="bg-red-50 p-4 rounded-xl shadow-md border-l-4 border-red-500">
    <h3 class="font-bold text-red-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-phone-volume mr-2"></i> ç·Šæ€¥æ±‚åŠ©é›»è©±ï¼ˆé»æ“Šæ’¥å‡ºï¼‰</h3>
    <div class="flex justify-around text-sm font-medium">
        <a href="tel:999" class="text-center text-slate-700 hover:text-red-600 p-1 rounded-md transition duration-150">
            ğŸ‡­ğŸ‡° **é¦™æ¸¯ï¼š** <span class="font-black text-xl">999</span>
        </a>
        <a href="tel:110" class="text-center text-slate-700 hover:text-red-600 p-1 rounded-md transition duration-150">
            ğŸ‡¨ğŸ‡³ **ä¸­åœ‹å¤§é™¸ ï¼š** <span class="font-black text-xl">110</span>
        </a>
    </div>
</div>

<div class="bg-yellow-50 p-4 rounded-xl shadow-md border-l-4 border-yellow-500">
    <h3 class="font-bold text-yellow-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-exclamation-circle mr-2"></i> æ—…éŠæ³¨æ„äº‹é …</h3>
    <ul class="list-disc list-inside text-sm space-y-1 text-slate-700">
        <li>**é›»æºï¼š** 220Véƒ¨åˆ†é›»å™¨éœ€ä½¿ç”¨è½‰æ¥é ­åŠè®Šå£“å™¨ã€‚</li>
        <li>**å…¥å¢ƒï¼š** ä¸å¯æ”œå¸¶åŠ ç†±ç…™åŠå¤šæ–¼19æ”¯é¦™ç…™å…¥å¢ƒ ã€‚</li>
        <li>**è­‰ä»¶ï¼š** è‹¥æœªéš¨èº«æ”œå¸¶èº«ä»½è­‰æ˜æ–‡ä»¶å±¬æ–¼é•æ³•</li>
    </ul>

</div>

            </section>

            <section v-if="currentTab === 'finance'">
                
                
                <div @click="openStatsModal" class="bg-slate-900 text-white p-4 rounded-2xl mb-4 shadow-lg cursor-pointer transition duration-150 hover:bg-slate-800">
                    <p class="text-xs opacity-70 flex justify-between items-center">
                        ç¸½æ”¯å‡º (TWD)
                        <i class="fa-solid fa-chart-pie text-base"></i>
                    </p>
                    <p class="text-2xl font-bold">TWD ${{ totalExpenseTWD.toFixed(0) }}</p>
                </div>

                <div class="space-y-2 mb-6 p-4 border border-dashed rounded-xl bg-orange-50">
                    <h4 class="font-bold text-slate-800 mb-2">æ–°å¢æ”¯å‡ºé …ç›®</h4>
                    
                    <div class="w-full">
                        <div v-if="newExpense.category === 'äº¤é€š' && newExpense.item !== 'å…¶ä»–äº¤é€š'">
                            <select v-model="newExpense.item" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="">è«‹é¸æ“‡äº¤é€šæ–¹å¼ (éå¿…å¡«)</option>
                                <option value="å·´å£«"><i class="fa-solid fa-bus"></i> å·´å£«</option>
                                <option value="åœ°éµ"><i class="fa-solid fa-train-subway"></i> åœ°éµ</option>
                                <option value="çš„å£«"><i class="fa-solid fa-taxi"></i> çš„å£«</option>
                                <option value="å…¶ä»–äº¤é€š"><i class="fa-solid fa-road"></i> å…¶ä»–</option>
                            </select>
                        </div>
                        <div v-else-if="newExpense.category === 'äº¤é€š' && newExpense.item === 'å…¶ä»–äº¤é€š'">
                               <input v-model="newExpense.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div v-else>
                            <input v-model="newExpense.item" placeholder="ç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                           <select v-model="newExpense.category" class="flex-1 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="åƒå–">åƒå–</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="è³¼ç‰©">è³¼ç‰©</option>
                                <option value="é–€ç¥¨">é–€ç¥¨</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                            <select v-model="newExpense.currency" class="w-20 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="HKD">HKD</option>
                                <option value="RMB">RMB</option>
                                <option value="TWD">TWD</option>
                            </select>
                    </div>

                    <select v-model="newExpense.method" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        <option value="å…«é”é€š">å…«é”é€š</option>
                        <option value="é›»å­æ”¯ä»˜">é›»å­æ”¯ä»˜</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                    <button @click="addExpense" :disabled="!newExpense.amount" class="w-full bg-orange-500 disabled:opacity-50 text-white p-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢æ”¯å‡º</button>
                </div>

                <div v-for="(exp, index) in expenses" :key="exp.id" class="p-3 border-b border-slate-200 hover:bg-slate-50 transition duration-100">
                    <div v-if="!exp.isEditing" class="flex justify-between items-start text-sm">
                        <div class="flex-1">
                            <span class="font-bold text-slate-800">{{ exp.item }}</span>
                            <small class="text-slate-400 block">{{ getCategoryLabel(exp.category) }} ({{ exp.method }})</small>
                        </div>
                        <div class="text-right">
                            <span class="font-medium text-red-500 text-base block">- {{ exp.currency }} {{ exp.amount }}</span>
                            <span v-if="exp.currency !== 'TWD'" class="text-xs text-slate-500">
                                (ç´„ TWD {{ convertToTWD(exp.amount, exp.currency).toFixed(0) }})
                            </span>
                            <div class="flex justify-end gap-3 pt-1 mt-1">
                                <button @click="toggleEdit(exp)" class="text-xs text-blue-500 hover:text-blue-700 font-medium"><i class="fa-solid fa-edit mr-1"></i>ç·¨è¼¯</button>
                                <button @click="deleteExpense(exp.id)" class="text-xs text-red-500 hover:text-red-700 font-medium"><i class="fa-solid fa-trash-alt mr-1"></i>åˆªé™¤</button>
                            </div>
                        </div>
                    </div>

                    <div v-else class="p-2 bg-white rounded-lg border border-blue-300">
                           <h4 class="font-bold text-sm mb-2 text-blue-600">ç·¨è¼¯æ”¯å‡º</h4>
                           
                           <div v-if="exp.category === 'äº¤é€š' && exp.item === 'å…¶ä»–äº¤é€š'">
                                <input v-model="exp.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                           </div>
                           <div v-else-if="exp.category === 'äº¤é€š'">
                                <select v-model="exp.item" class="w-full p-2 border rounded-lg text-sm mb-2 bg-white focus:ring-blue-500 focus:border-blue-500">
                                    <option value="å·´å£«">å·´å£«</option>
                                    <option value="åœ°éµ">åœ°éµ</option>
                                    <option value="çš„å£«">çš„å£«</option>
                                    <option value="å…¶ä»–äº¤é€š">å…¶ä»–</option>
                                </select>
                           </div>
                           <div v-else>
                                <input v-model="exp.item" placeholder="ç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                           </div>

                           <div class="flex gap-2 mb-2">
                                <select v-model="exp.category" class="flex-1 p-2 border rounded-lg text-sm bg-white">
                                    <option value="åƒå–">åƒå–</option>
                                    <option value="äº¤é€š">äº¤é€š</option>
                                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                                    <option value="é–€ç¥¨">é–€ç¥¨</option>
                                    <option value="å…¶ä»–">å…¶ä»–</option>
                                </select>
                                <input v-model.number="exp.amount" type="number" placeholder="é‡‘é¡" class="w-1/3 p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                 <select v-model="exp.currency" class="w-1/4 p-2 border rounded-lg text-sm bg-white">
                                    <option value="HKD">HKD</option>
                                    <option value="RMB">RMB</option>
                                    <option value="TWD">TWD</option>
                                </select>
                           </div>
                           <select v-model="exp.method" class="w-full p-2 border rounded-lg text-sm mb-3 bg-white">
                                <option value="ç¾é‡‘">ç¾é‡‘</option>
                                <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                                <option value="å…«é”é€š">å…«é”é€š</option>
                                <option value="é›»å­æ”¯ä»˜">é›»å­æ”¯ä»˜</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                           </select>

                           <button @click="toggleEdit(exp)" class="w-full bg-blue-600 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                                 å„²å­˜ä¿®æ”¹ <i class="fa-solid fa-save ml-1"></i>
                           </button>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'wishlist'" class="space-y-4">
                <div class="mb-4">
                    <select v-model="selectedMember" class="w-full p-3 border border-orange-300 rounded-xl text-sm font-bold bg-white shadow-md focus:ring-2 focus:ring-orange-500">
                        <option value="å…¨éƒ¨">æ‰€æœ‰äºº (é¡¯ç¤ºæ‰€æœ‰é¡˜æœ›)</option>
                        <option v-for="member in members" :key="member" :value="member">{{ member }}</option>
                    </select>
                </div>

                <div class="flex gap-2 mb-6">
                    <select v-model="newWishItem.member" class="p-3 border rounded-xl text-sm bg-white font-medium">
                        <option v-for="member in members" :key="member + '_add'" :value="member">{{ member }}</option>
                    </select>
                    <input v-model="newWishItem.item" @keyup.enter="addWishItem" placeholder="æƒ³è²·ä»€éº¼..." class="flex-1 p-3 border rounded-lg text-sm focus:ring-orange-500 focus:border-orange-500">
                    <button @click="addWishItem" class="bg-slate-900 text-white px-4 rounded-xl active:scale-95 transition"><i class="fa-solid fa-plus"></i></button>
                </div>

                <div v-if="filteredWishlist.length > 0" class="space-y-2">
                    <div v-for="(item, index) in filteredWishlist" :key="item.id" class="flex items-center p-3 bg-slate-50 rounded-xl justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" v-model="item.done" class="mr-3 w-5 h-5 accent-orange-500">
                            <span :class="{'line-through text-slate-400': item.done}" class="text-sm font-medium">{{ item.item }}</span>
                        </div>
                        <span v-if="selectedMember === 'å…¨éƒ¨'" class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ item.member }}</span>
                        
                        <button @click="deleteWishItem(item.id)" class="ml-3 text-red-500 hover:text-red-700">
                            <i class="fa-solid fa-times text-xs"></i>
                        </button>
                    </div>
                </div>
                <div v-else class="text-center text-slate-500 p-8 border border-dashed rounded-xl">
                    <i class="fa-solid fa-face-frown text-2xl mb-2"></i>
                    <p>{{ selectedMember }} çš„é¡˜æœ›æ¸…å–®æ˜¯ç©ºçš„ï¼</p>
                </div>
            </section>

        </main>
        
        <div v-if="isStatsModalOpen" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex justify-center items-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-sm">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-xl font-bold text-slate-800">æ”¯å‡ºåˆ†æ (TWD)</h3>
                    <button @click="isStatsModalOpen = false" class="text-gray-500 hover:text-gray-800">
                        <i class="fa-solid fa-times text-lg"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="w-full h-64 flex justify-center">
                        <canvas id="expenseChart"></canvas>
                    </div>

                    <h4 class="font-bold text-sm text-orange-600 mt-4">ç¸½æ”¯å‡º TWD ${{ totalExpenseTWD.toFixed(0) }}</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div v-for="(amount, category) in categoryTotals" :key="category" class="flex justify-between border-b pb-1">
                            <span>{{ category }}</span>
                            <span class="font-medium text-slate-700">TWD {{ amount.toFixed(0) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
<script>
    const { createApp, ref, computed, watch, nextTick } = Vue;

    // --- Local Storage åŠ©æ‰‹å‡½å¼ï¼šè®€å–èˆ‡å„²å­˜é€šç”¨é‚è¼¯ ---

    function loadData(key, defaultData = []) {
        try {
            const stored = localStorage.getItem(key);
            const data = stored ? JSON.parse(stored) : defaultData;
            
            if (key === 'hk_trip_expenses') {
                return data.map(item => ({ 
                    id: item.id || Date.now() + Math.random(), 
                    category: item.category || 'å…¶ä»–', 
                    isEditing: item.isEditing || false, 
                    item: item.item || '', 
                    ...item 
                }));
            }
            return data;
        } catch (e) {
            console.error(`ç„¡æ³•å¾ Local Storage è®€å–è³‡æ–™: ${key}`, e);
            return defaultData;
        }
    }

    function saveData(key, list) {
        const cleanedList = list.map(({ isEditing, ...rest }) => rest);
        localStorage.setItem(key, JSON.stringify(cleanedList));
    }


    // -------------------------------------------------------
    // Vue App å•Ÿå‹•å‰çš„æ•¸æ“šè™•ç† 
    // -------------------------------------------------------

    // ğŸš© æ•¸æ“šä¿®æ”¹å€ï¼šè¡Œç¨‹èˆ‡æ™¯é» ğŸš©
    const FIXED_SCHEDULE = [
        // **æ ¹æ“šä½¿ç”¨è€…æä¾›çš„åŸå¸‚é †åº 25é¦™æ¸¯ -> 4é¦™æ¸¯ é‡æ–°ç·¨æ’**
        // ç‚ºäº†è®“è¡Œç¨‹å…§å®¹å…·æœ‰é€£è²«æ€§ï¼Œæˆ‘ç›¡é‡ä¿ç•™äº†ä¹‹å‰çš„æè¿°ï¼Œä¸¦ç‚ºæ–°å¢çš„å»£å·å’Œé‡è¤‡çš„åŸå¸‚å¡«å¯«äº†æ–°çš„æè¿°ã€‚
        // id ä¸è®Šï¼Œä½†é †åºè®Šäº†
        { id: 1, date: '12/25', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'æŠµæ¸¯ã€check-in é¦™æ¸¯å®¶ã€æ—ºè§’æ™šé¤', weather: 'æ™´æ™‚å¤šé›²', temp: '18Â°C / 13Â°C' },
        { id: 2, date: '12/26', city: 'æ·±åœ³', city_code: 'SZ', desc: 'å‰å¾€æ·±åœ³ã€è¯åƒ‘åŸå‰µæ„æ–‡åŒ–åœ’ã€æ™šé¤å¾Œç¾…æ¹–å£å²¸éå¢ƒå›æ¸¯', weather: 'æ™´æœ—', temp: '20Â°C / 15Â°C' },
        { id: 3, date: '12/27', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'å¤§å¶¼å±±å¤©å£‡å¤§ä½›ã€å¤§æ¾³æ¼æ‘', weather: 'å¤šé›²', temp: '16Â°C / 11Â°C' },
        { id: 7, date: '12/28', city: 'å»£å·', city_code: 'GZ', desc: 'æ­ä¹˜å»£ä¹ç›´é€šè»Šè‡³å»£å·ã€è¶Šç§€å…¬åœ’ã€å»£å·å¡”å¤œæ™¯', weather: 'å¤§é›¨', temp: '15Â°C / 10Â°C' }, 
        { id: 8, date: '12/29', city: 'å»£å·', city_code: 'GZ', desc: 'æ²™é¢å³¶ç•°åœ‹å»ºç¯‰ç¾¤ã€è”æç£æ¹§ã€æ™šé¤é«”é©—ç²µå¼é»å¿ƒ', weather: 'æ™´æ™‚å¤šé›²', temp: '16Â°C / 11Â°C' }, 
        { id: 9, date: '12/30', city: 'æ·±åœ³', city_code: 'SZ', desc: 'é«˜éµè¿”å›æ·±åœ³ã€ä¸–ç•Œä¹‹çª—ä¸»é¡Œæ¨‚åœ’ä¸€æ—¥éŠ', weather: 'å¤šé›²', temp: '19Â°C / 14Â°C' },
        { id: 10, date: '12/31', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'å°–æ²™å’€æµ·æ—æˆ–ç¶­å¤šåˆ©äºæ¸¯è·¨å¹´å€’æ•¸ï¼ˆé‡é»è¡Œç¨‹ï¼‰', weather: 'æ™´æœ—', temp: '17Â°C / 12Â°C' },
        { id: 11, date: '01/01', city: 'æ·±åœ³', city_code: 'SZ', desc: 'æ–°å¹´ç¬¬ä¸€å¤©ï¼šæ·±åœ³æ­¡æ¨‚æµ·å²¸æ°´ç§€åŠ‡å ´ã€è‡ªç”±è³¼ç‰©', weather: 'å°é›¨', temp: '18Â°C / 13Â°C' },
        { id: 4, date: '01/02', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'é¦™æ¸¯è¿ªå£«å°¼æ¨‚åœ’å…¨æ—¥éŠ', weather: 'æ™´æ™‚å¤šé›²', temp: '17Â°C / 12Â°C' },
        { id: 5, date: '01/03', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'ä¸­ç’°å¤§é¤¨ã€çŸ³æ¿è¡—ã€å±±é ‚çºœè»Š', weather: 'å¤šé›²', temp: '16Â°C / 11Â°C' },
        { id: 6, date: '01/04', city: 'é¦™æ¸¯', city_code: 'HK', desc: 'æœ€å¾Œæ¡è²·ã€å‰å¾€æ©Ÿå ´æ­ä¹˜é•·æ¦®BR868å›ç¨‹', weather: 'æ™´æœ—', temp: '19Â°C / 14Â°C' }
    ];
    
    // æ™¯é»å·²ç§»é™¤
    
    const FIXED_MEMBERS = ['çˆ¸çˆ¸', 'åª½åª½', 'æ©å®œ', 'æŸå‘ˆ', 'å”æ²›'];
    
    const defaultExpenses = []; 
    const defaultWishlist = [{ id: 1, member: 'æ©å®œ', item: 'å°ç†Šç¶­å°¼å…¬ä»”', done: false }];

    const initialExpenses = loadData('hk_trip_expenses', defaultExpenses);
    const initialWishlist = loadData('hk_trip_wishlist', defaultWishlist);

    let nextExpenseId = (initialExpenses.length > 0 ? Math.max(...initialExpenses.map(e => e.id)) : 0) + 1;
    let nextWishId = (initialWishlist.length > 0 ? Math.max(...initialWishlist.map(w => w.id)) : 0) + 1;

    // ğŸš© æ ¸å¿ƒåŒ¯ç‡å¸¸é‡ ğŸš©
    const RMB_RATE = 4.4; 
    const HKD_RATE = 4.0;
    
    // å®šç¾©åœ–è¡¨é¡è‰² (Chart.js é¡è‰²é…ç½®)
    const CHART_COLORS = [
        '#FF6384', 
        '#36A2EB', 
        '#FFCD56', 
        '#4BC0C0', 
        '#9966FF', 
        '#FF9F40'
    ];
    
    let expenseChartInstance = null;
    
    // =======================================================
    // ğŸ’¡ æ–¹ä¾¿æ‰‹å‹•æ›´æ–°å¤©æ°£çš„ Font Awesome åœ–æ¨™é¡å‚™è¨» ğŸ’¡
    /*
    ** Font Awesome å¤©æ°£åœ–æ¨™åƒè€ƒ (è«‹åœ¨ getWeatherIcon å‡½å¼ä¸­æˆ–ç›´æ¥åœ¨æ¨¡æ¿ä¸­æ›¿æ› fa-xxx éƒ¨åˆ†): **
    
    --- å¤ªé™½/æ™´æœ— ---
    * æ™´å¤© / å¤§å¤ªé™½: `fa-sun`
    * æ™´æ™‚å¤šé›² / å±€éƒ¨å¤šé›²: `fa-cloud-sun`
    
    --- é›²/é™°å¤© ---
    * å¤šé›² / é™°å¤©: `fa-cloud`
    * æ¿ƒéœ§ / éœ§éœ¾: `fa-smog`
    
    --- é™é›¨ ---
    * å°é›¨ / é™£é›¨: `fa-cloud-rain`
    * å¤§é›¨ / æš´é›¨: `fa-cloud-showers-heavy`
    * é›·é›¨ / æ‰“é›·: `fa-bolt`
    
    --- å…¶ä»– ---
    * ä¸‹é›ª: `fa-snowflake`
    * é¢¨: `fa-wind`
    * æœªçŸ¥: `fa-question-circle`
    */
    // =======================================================


    createApp({
        setup() {
            const currentTab = ref('itinerary'); 
            const isStatsModalOpen = ref(false); 
            
            // --- æ•¸æ“šçµæ§‹ (Ref) ---
            const schedule = ref(FIXED_SCHEDULE);
            // landmarks å·²ç§»é™¤
            const expenses = ref(initialExpenses);
            const newExpense = ref({ 
                item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒå–' 
            });
            const members = FIXED_MEMBERS;
            const wishlist = ref(initialWishlist);
            const selectedMember = ref('å…¨éƒ¨'); 
            const newWishItem = ref({ member: 'æ©å®œ', item: '' }); 
            const calculator = ref({ amount: null, currency: 'HKD' });


            // =======================================================
            // ğŸš© æ ¸å¿ƒé‚è¼¯å€ ğŸš©
            // =======================================================
            
            // ğŸ’¡ æ ¹æ“šå¤©æ°£æè¿°è¿”å› Font Awesome åœ–ç¤º
            function getWeatherIcon(weather) {
                if (!weather) return 'fa-question-circle';
                if (weather.includes('æ™´') && !weather.includes('å¤šé›²')) return 'fa-sun'; // èª¿æ•´ï¼šå–®ç´”çš„æ™´æœ—ç”¨å¤ªé™½
                if (weather.includes('æ™´æ™‚å¤šé›²')) return 'fa-cloud-sun'; 
                if (weather.includes('é›¨') || weather.includes('å¤§é›¨')) return 'fa-cloud-rain';
                if (weather.includes('å¤šé›²') || weather.includes('é™°')) return 'fa-cloud';
                return 'fa-cloud-sun'; // é è¨­å€¼
            }
            
            // ğŸ’° åŒ¯ç‡è½‰æ›å‡½å¼ (å¾ä»»ä½•å¹£åˆ¥è½‰ TWD)
            function convertToTWD(amount, currency) {
                amount = Number(amount) || 0;
                switch (currency) {
                    case 'RMB': return amount * RMB_RATE; 
                    case 'HKD': return amount * HKD_RATE; 
                    case 'TWD': return amount; 
                    default: return 0;
                }
            }
            
            // è¼”åŠ©å‡½å¼ï¼šæ ¹æ“š category ä»£ç¢¼ç²å–æ˜“è®€æ¨™ç±¤
            function getCategoryLabel(category) {
                if (!category) return 'ğŸ’¡ å…¶ä»–'; 
                
                switch (category) {
                    case 'åƒå–': return 'ğŸ½ï¸ åƒå–';
                    case 'äº¤é€š': return 'ğŸšŒ äº¤é€š';
                    case 'è³¼ç‰©': return 'ğŸ›ï¸ è³¼ç‰©';
                    case 'é–€ç¥¨': return 'ğŸŸï¸ é–€ç¥¨';
                    default: return 'ğŸ’¡ å…¶ä»–';
                }
            }


            // ğŸ’° åŒ¯ç‡è¨ˆç®—å±¬æ€§ (çµ¦ä¸Šæ–¹è¨ˆç®—æ©Ÿä½¿ç”¨)
            const calculatedTWD = computed(() => {
                return convertToTWD(calculator.value.amount, calculator.value.currency);
            });
            

            // --- è¨˜å¸³ CRUD ---
            
            // ğŸ¯ è¨ˆç®—å„åˆ†é¡ç¸½æ”¯å‡º (Computed Property)
            const categoryTotals = computed(() => {
                const totals = { 'åƒå–': 0, 'äº¤é€š': 0, 'è³¼ç‰©': 0, 'é–€ç¥¨': 0, 'å…¶ä»–': 0 };
                
                expenses.value.forEach(exp => {
                    const twdAmount = convertToTWD(exp.amount, exp.currency);
                    const mainCategoryKey = exp.category || 'å…¶ä»–'; 
                    
                    if (totals.hasOwnProperty(mainCategoryKey)) {
                        totals[mainCategoryKey] += twdAmount;
                    } else {
                        totals['å…¶ä»–'] += twdAmount;
                    }
                });
                return totals;
            });

            // è¨ˆç®—ç¸½æ”¯å‡º (Computed Property) - TWD ç¸½é¡
            const totalExpenseTWD = computed(() => {
                return expenses.value.reduce((total, exp) => {
                    return total + convertToTWD(exp.amount, exp.currency);
                }, 0);
            });
            
            // æ–°å¢æ”¯å‡ºå‡½å¼
            function addExpense() {
                // åƒ…æª¢æŸ¥é‡‘é¡æ˜¯å¦å¡«å¯«
                if (newExpense.value.amount) {
                    expenses.value.unshift({ 
                        ...newExpense.value, 
                        id: nextExpenseId++,
                        isEditing: false,
                        // è™•ç†ç°¡è¿°ï¼šå¦‚æœ item ç‚ºç©ºå­—ä¸²ï¼Œå°‡å…¶æ›¿æ›ç‚ºé¡åˆ¥åç¨±
                        item: newExpense.value.item || newExpense.value.category
                    });
                    
                    // é‡è¨­è¡¨å–®
                    newExpense.value = { item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒå–' };
                }
            }

            // ç·¨è¼¯/å„²å­˜åˆ‡æ›å‡½å¼
            function toggleEdit(item) { 
                item.isEditing = !item.isEditing; 
                // å¦‚æœæ˜¯å„²å­˜å‹•ä½œï¼Œç¢ºä¿ item ä¸ç‚ºç©º (çµ¦äºˆé¡åˆ¥åç¨±ä½œç‚ºé è¨­å€¼)
                if (!item.isEditing && !item.item) {
                       item.item = item.category;
                }
            }

            // åˆªé™¤æ”¯å‡ºå‡½å¼
            function deleteExpense(id) {
                expenses.value = expenses.value.filter(exp => exp.id !== id);
            }

            // ğŸŒŸ åœ“é¤…åœ–ç¹ªè£½é‚è¼¯ ğŸŒŸ
            function renderChart() {
                if (expenseChartInstance) {
                    expenseChartInstance.destroy(); 
                }

                const ctx = document.getElementById('expenseChart').getContext('2d');
                const totals = categoryTotals.value;
                
                const labels = Object.keys(totals).filter(key => totals[key] > 0);
                const data = labels.map(key => totals[key]);

                expenseChartInstance = new Chart(ctx, {
                    type: 'doughnut', 
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: CHART_COLORS.slice(0, labels.length),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: TWD ${value.toFixed(0)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // ğŸŒŸ æ‰“é–‹çµ±è¨ˆå½ˆçª—ä¸¦ç¹ªè£½åœ–è¡¨ ğŸŒŸ
            function openStatsModal() {
                isStatsModalOpen.value = true;
                nextTick(() => {
                    renderChart();
                });
            }
            
            // ğŸŒŸ ç›£è½æ–°æ”¯å‡ºé¡åˆ¥åˆ‡æ›ï¼Œæ¸…ç©ºç°¡è¿°ä»¥é¿å…æ®˜ç•™
            watch(() => newExpense.value.category, (newCategory) => {
                newExpense.value.item = ''; 
            });


            // --- é¡˜æœ›æ¸…å–® CRUD (ä¿æŒä¸è®Š) ---
            
            const filteredWishlist = computed(() => {
                if (selectedMember.value === 'å…¨éƒ¨') {
                    return [...wishlist.value].sort((a, b) => members.indexOf(a.member) - members.indexOf(b.member));
                }
                return wishlist.value.filter(item => item.member === selectedMember.value);
            });
            
            function addWishItem() {
                if (newWishItem.value.item && newWishItem.value.member) {
                    wishlist.value.push({ 
                        id: nextWishId++,
                        member: newWishItem.value.member,
                        item: newWishItem.value.item, 
                        done: false 
                    });
                    newWishItem.value.item = ''; 
                    selectedMember.value = newWishItem.value.member;
                }
            }
            
            function deleteWishItem(id) {
                wishlist.value = wishlist.value.filter(item => item.id !== id);
            }
            
            // =======================================================
            // ğŸš© æ•¸æ“šè®Šå‹•ç›£è½å™¨ï¼šè‡ªå‹•å„²å­˜åˆ° Local Storage ğŸš©
            // =======================================================

            const watchOptions = { deep: true };
            watch(expenses, (newList) => saveData('hk_trip_expenses', newList), watchOptions);
            watch(wishlist, (newList) => saveData('hk_trip_wishlist', newList), watchOptions);


            return { 
                currentTab, 
                isStatsModalOpen, 
                openStatsModal, 
                // è¡Œç¨‹ (åªè®€ - ä¾†è‡ª FIXED_*)
                schedule, getWeatherIcon, // æ–°å¢ getWeatherIcon
                // è¨˜å¸³
                expenses, newExpense, totalExpenseTWD, categoryTotals, addExpense, deleteExpense, toggleEdit, getCategoryLabel, convertToTWD,
                // åŒ¯ç‡è¨ˆç®—
                calculator, calculatedTWD,
                // é¡˜æœ›æ¸…å–®
                members, selectedMember, wishlist, filteredWishlist, newWishItem, addWishItem, deleteWishItem
            };
        }
    }).mount('#app');
</script>
</body>
</html>