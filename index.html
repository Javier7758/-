<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è·¨å¹´æ—…è¡Œ | é›²ç«¯åŒæ­¥ç‰ˆ (åŒ¿å)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .tab-active { color: #ff0000; border-bottom: 2px solid #ff0000; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="app" class="max-w-md mx-auto min-h-screen pb-20 relative shadow-2xl bg-white">
        
        <header class="bg-slate-900 text-white p-6 rounded-b-3xl shadow-lg">
            <h1 class="text-2xl font-bold italic">è·¨å¹´æ—…è¡Œ <span class="text-orange-500">2026</span></h1>
            
            <div class="mt-2 flex justify-between items-center text-sm">
                <p v-if="user" class="opacity-75">
                    âœ… é›²ç«¯é€£ç·šæˆåŠŸ 
                    <span class="ml-2 px-2 py-0.5 rounded-full text-xs bg-green-500 text-white font-bold">è‡ªå‹•åŒæ­¥ä¸­</span>
                </p>
                <p v-else class="text-yellow-400">ğŸš¨ æ­£åœ¨å˜—è©¦é€£ç·š...</p>
            </div>
            </header>

        <nav class="flex justify-around bg-white border-b sticky top-0 z-10 text-slate-400 font-medium">
            <button @click="currentTab = 'itinerary'" :class="{'tab-active': currentTab === 'itinerary'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-calendar-days block text-lg mb-1"></i>è¡Œç¨‹</button>
            <button @click="currentTab = 'landmarks'" :class="{'tab-active': currentTab === 'landmarks'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-camera block text-lg mb-1"></i>æ™¯é»</button>
            <button @click="currentTab = 'finance'" :class="{'tab-active': currentTab === 'finance'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-wallet block text-lg mb-1"></i>è¨˜å¸³</button>
            <button @click="currentTab = 'wishlist'" :class="{'tab-active': currentTab === 'wishlist'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-gift block text-lg mb-1"></i>é¡˜æœ›</button>
            
            <a href="https://www.gbaweather.net/tc/" target="_blank" class="py-4 flex-1 text-sm flex flex-col items-center justify-center text-slate-400 hover:text-orange-500 transition duration-150">
                <i class="fa-solid fa-cloud-sun block text-lg mb-1"></i>
                å¤©æ°£
            </a>
        </nav>

        <main class="p-4">
            
            <section v-if="currentTab === 'itinerary'" class="space-y-4">
                <div v-if="!user" class="p-4 bg-yellow-100 text-yellow-700 rounded-xl text-center font-medium">æ­£åœ¨é€£ç·šé›²ç«¯ï¼Œè«‹ç¨å€™...</div>

                <div class="bg-white p-4 rounded-2xl shadow-lg border border-orange-200">
                    <h3 class="font-bold text-orange-600 mb-3">æ–°å¢è¡Œç¨‹</h3>
                    <input v-model="newScheduleItem.date" placeholder="æ—¥æœŸ (e.g., 12/26)" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <input v-model="newScheduleItem.tag" placeholder="æ¨™ç±¤ (e.g., è³¼ç‰©, åˆé¤) (é¸å¡«)" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <textarea v-model="newScheduleItem.desc" placeholder="è¡Œç¨‹æè¿°..." rows="2" class="w-full p-2 border rounded-lg text-sm mb-3 focus:ring-orange-500 focus:border-orange-500" :disabled="!user"></textarea>
                    <button @click="addScheduleItem" :disabled="!newScheduleItem.date || !newScheduleItem.desc || !user" class="w-full bg-slate-900 disabled:opacity-50 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                        æ–°å¢æ—¥ç¨‹ <i class="fa-solid fa-calendar-plus ml-1"></i>
                    </button>
                </div>

                <div v-for="day in schedule" :key="day.id" class="border-l-4 border-orange-500 pl-4 py-2 relative bg-white rounded-r-xl p-3 shadow-md hover:shadow-lg transition">
                    
                    <div v-if="!day.isEditing">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-900">{{ day.date }}</span>
                            <span class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ day.tag }}</span>
                        </div>
                        <p class="text-sm text-slate-600 mb-3">{{ day.desc }}</p>
                        <div class="flex justify-end gap-3 pt-1 border-t border-slate-100 mt-2">
                            <button @click="toggleEdit(day)" :disabled="!user" class="text-xs text-blue-500 disabled:opacity-50 hover:text-blue-700 font-medium"><i class="fa-solid fa-edit mr-1"></i>ç·¨è¼¯</button>
                            <button @click="deleteScheduleItem(day.id)" :disabled="!user" class="text-xs text-red-500 disabled:opacity-50 hover:text-red-700 font-medium"><i class="fa-solid fa-trash-alt mr-1"></i>åˆªé™¤</button>
                        </div>
                    </div>

                    <div v-else>
                         <h4 class="font-bold text-sm mb-2 text-orange-600">ç·¨è¼¯è¡Œç¨‹</h4>
                         <input v-model="day.date" placeholder="æ—¥æœŸ (e.g., 12/26)" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500">
                         <input v-model="day.tag" placeholder="æ¨™ç±¤" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500">
                         <textarea v-model="day.desc" placeholder="è¡Œç¨‹æè¿°..." rows="2" class="w-full p-2 border rounded-lg text-sm mb-3 focus:ring-orange-500 focus:border-orange-500"></textarea>
                         <button @click="toggleEdit(day)" class="w-full bg-green-600 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                             å„²å­˜ä¿®æ”¹ <i class="fa-solid fa-save ml-1"></i>
                         </button>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'landmarks'" class="space-y-4">
                 <div v-if="!user" class="p-4 bg-yellow-100 text-yellow-700 rounded-xl text-center font-medium">æ­£åœ¨é€£ç·šé›²ç«¯ï¼Œè«‹ç¨å€™...</div>
                
                <div class="bg-white p-4 rounded-2xl shadow-lg border border-orange-200">
                    <h3 class="font-bold text-orange-600 mb-3">æ–°å¢æ™¯é»</h3>
                    <input v-model="newLandmarkItem.name" placeholder="æ™¯é»åç¨± (e.g., å¤ªå¹³å±±é ‚)" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <input v-model="newLandmarkItem.type" placeholder="æ™¯é»é¡å‹ (e.g., è‡ªç„¶æ™¯è§€)" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <textarea v-model="newLandmarkItem.desc" placeholder="æ™¯é»ä»‹ç´¹/ç­†è¨˜..." rows="2" class="w-full p-2 border rounded-lg text-sm mb-3 focus:ring-orange-500 focus:border-orange-500" :disabled="!user"></textarea>
                    <button @click="addLandmarkItem" :disabled="!newLandmarkItem.name || !user" class="w-full bg-slate-900 disabled:opacity-50 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                        æ–°å¢æ™¯é» <i class="fa-solid fa-plus ml-1"></i>
                    </button>
                </div>

                <div v-for="item in landmarks" :key="item.id" class="p-4 border rounded-2xl flex flex-col bg-white shadow-sm hover:shadow-md transition">
                    
                    <div v-if="!item.isEditing">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-bold text-slate-900">{{ item.name }}</h3>
                                <p class="text-xs text-orange-600">{{ item.type }}</p>
                            </div>
                            <a :href="'http://googleusercontent.com/maps.google.com/search?q=' + item.name + '+é¦™æ¸¯'" target="_blank" class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full hover:bg-slate-200">å°èˆª <i class="fa-solid fa-location-arrow ml-1"></i></a>
                        </div>
                        <p class="text-sm text-slate-600 mb-3">{{ item.desc }}</p>
                        <div class="flex justify-end gap-3 pt-1 border-t border-slate-100 mt-2">
                            <button @click="toggleLandmarkEdit(item)" :disabled="!user" class="text-xs text-blue-500 disabled:opacity-50 hover:text-blue-700 font-medium"><i class="fa-solid fa-edit mr-1"></i>ç·¨è¼¯</button>
                            <button @click="deleteLandmarkItem(item.id)" :disabled="!user" class="text-xs text-red-500 disabled:opacity-50 hover:text-red-700 font-medium"><i class="fa-solid fa-trash-alt mr-1"></i>åˆªé™¤</button>
                        </div>
                    </div>

                    <div v-else>
                         <h4 class="font-bold text-sm mb-2 text-orange-600">ç·¨è¼¯æ™¯é»</h4>
                         <input v-model="item.name" placeholder="æ™¯é»åç¨±" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500">
                         <input v-model="item.type" placeholder="æ™¯é»é¡å‹" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-orange-500 focus:border-orange-500">
                         <textarea v-model="item.desc" placeholder="æ™¯é»ä»‹ç´¹/ç­†è¨˜..." rows="2" class="w-full p-2 border rounded-lg text-sm mb-3 focus:ring-orange-500 focus:border-orange-500"></textarea>
                         <button @click="toggleLandmarkEdit(item)" class="w-full bg-green-600 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                             å„²å­˜ä¿®æ”¹ <i class="fa-solid fa-save ml-1"></i>
                         </button>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'finance'">
                <div v-if="!user" class="p-4 bg-yellow-100 text-yellow-700 rounded-xl text-center font-medium">æ­£åœ¨é€£ç·šé›²ç«¯ï¼Œè«‹ç¨å€™...</div>

                <div class="bg-slate-900 text-white p-4 rounded-2xl mb-4 flex justify-between">
                    <div><p class="text-xs opacity-70">ç¸½æ”¯å‡º (HKD)</p><p class="text-2xl font-bold">${{ totalExpense }}</p></div>
                    <i class="fa-solid fa-chart-pie text-orange-500 text-3xl opacity-50"></i>
                </div>
                <div class="space-y-2 mb-6">
                    <input v-model="newExpense.item" placeholder="å“é …" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <div class="flex gap-2">
                        <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                        <select v-model="newExpense.method" class="flex-1 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                            <option value="ç¾é‡‘">ğŸ’µ ç¾é‡‘</option>
                            <option value="ä¿¡ç”¨å¡">ğŸ’³ ä¿¡ç”¨å¡</option>
                            <option value="å…«é”é€š">ğŸšŒ å…«é”é€š</option>
                            <option value="é›»å­æ”¯ä»˜">ğŸ“± é›»å­æ”¯ä»˜</option>
                        </select>
                    </div>
                    <button @click="addExpense" :disabled="!user" class="w-full bg-orange-500 text-white p-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢æ”¯å‡º</button>
                </div>
                <div v-for="(exp, index) in expenses" :key="index" class="flex justify-between p-3 border-b text-sm">
                    <span>{{ exp.item }} <small class="text-slate-400">({{ exp.method }})</small></span>
                    <span class="font-medium text-red-500">-${{ exp.amount }}</span>
                </div>
            </section>

            <section v-if="currentTab === 'wishlist'" class="space-y-4">
                 <div v-if="!user" class="p-4 bg-yellow-100 text-yellow-700 rounded-xl text-center font-medium">æ­£åœ¨é€£ç·šé›²ç«¯ï¼Œè«‹ç¨å€™...</div>

                <div class="mb-4">
                    <select v-model="selectedMember" class="w-full p-3 border border-orange-300 rounded-xl text-sm font-bold bg-white shadow-md focus:ring-2 focus:ring-orange-500">
                        <option value="å…¨éƒ¨">æ‰€æœ‰äºº (é¡¯ç¤ºæ‰€æœ‰é¡˜æœ›)</option>
                        <option v-for="member in members" :key="member" :value="member">{{ member }}</option>
                    </select>
                </div>

                <div class="flex gap-2 mb-6">
                    <select v-model="newWishItem.member" class="p-3 border rounded-xl text-sm bg-white font-medium" :disabled="!user">
                        <option v-for="member in members" :key="member + '_add'" :value="member">{{ member }}</option>
                    </select>
                    <input v-model="newWishItem.item" @keyup.enter="addWishItem" placeholder="æƒ³è²·ä»€éº¼..." class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500" :disabled="!user">
                    <button @click="addWishItem" :disabled="!user" class="bg-slate-900 text-white px-4 rounded-xl active:scale-95 transition"><i class="fa-solid fa-plus"></i></button>
                </div>

                <div v-if="filteredWishlist.length > 0" class="space-y-2">
                    <div v-for="(item, index) in filteredWishlist" :key="item.id" class="flex items-center p-3 bg-slate-50 rounded-xl justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" v-model="item.done" :disabled="!user" class="mr-3 w-5 h-5 accent-orange-500">
                            <span :class="{'line-through text-slate-400': item.done}" class="text-sm font-medium">{{ item.item }}</span>
                        </div>
                        <span v-if="selectedMember === 'å…¨éƒ¨'" class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ item.member }}</span>
                    </div>
                </div>
                <div v-else class="text-center text-slate-500 p-8 border border-dashed rounded-xl">
                    <i class="fa-solid fa-face-frown text-2xl mb-2"></i>
                    <p>{{ selectedMember }} çš„é¡˜æœ›æ¸…å–®æ˜¯ç©ºçš„ï¼</p>
                </div>
            </section>

        </main>
    </div>
<script>
    const { createApp, ref, computed, watch } = Vue;

    // =======================================================
    // ğŸš© ä½ çš„ Firebase Config (è«‹å‹™å¿…æ›¿æ›ç‚ºä½ å°ˆå±¬çš„é‡‘é‘°ï¼) ğŸš©
    // =======================================================
    const firebaseConfig = {
        apiKey: "AIzaSyDVWuYmV0Cp3REPJ-gIybjNjTtdLW0mST8", 
        authDomain: "project-8464896306397913259.firebaseapp.com",
        projectId: "project-8464896306397913259",
        storageBucket: "project-8464896306397913259.firebasestorage.app",
        messagingSenderId: "647207538830",
        appId: "1:647207538830:web:d1d5447961c615334179df"
    };

    // é—œéµè®Šæ•¸ï¼šç¾¤çµ„ ID (æ‰€æœ‰è³‡æ–™éƒ½å­˜åœ¨é€™å€‹ ID ä¸‹)
    const GROUP_ID = "HK2026_TRIP"; 

    // åˆå§‹åŒ– Firebase å’Œæœå‹™
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // å„²å­˜è³‡æ–™çš„é è¨­çµæ§‹ï¼ˆç”¨æ–¼é¦–æ¬¡ç”¨æˆ¶ï¼‰
    const defaultData = {
        schedule: [
            { id: 1, date: '12/25', tag: 'å•Ÿç¨‹', desc: 'æŠµæ¸¯ã€check-in', isEditing: false },
        ],
        landmarks: [
            { id: 1, name: 'é¦™æ¸¯è¿ªå£«å°¼æ¨‚åœ’', type: 'éŠæ¨‚æ™¯é»', desc: 'é è¨ˆ 1/2', isEditing: false },
        ],
        expenses: [{ item: 'æ©Ÿç¥¨', amount: 8000, method: 'ä¿¡ç”¨å¡' }],
        wishlist: [{ id: 1, member: 'æ©å®œ', item: 'å°ç†Šç¶­å°¼å…¬ä»”', done: false }],
    };

    // =======================================================
    // ğŸš© æ ¸å¿ƒåŒæ­¥é‚è¼¯ (å…¨å“¡å¯è®€å¯«) ğŸš©
    // =======================================================

    // å¾ Firestore è®€å–æ‰€æœ‰è³‡æ–™
    function loadAllDataFromFirestore() {
        db.collection('groups').doc(GROUP_ID).get()
            .then((doc) => {
                const data = doc.exists ? doc.data() : defaultData;
                
                // 1. è¼‰å…¥è¡Œç¨‹ (Schedule)
                schedule.value = data.schedule.map(item => ({ ...item, isEditing: false }));
                const maxSId = schedule.value.length > 0 ? Math.max(...schedule.value.map(s => s.id)) : 0;
                nextScheduleId = maxSId + 1;

                // 2. è¼‰å…¥æ™¯é» (Landmarks)
                landmarks.value = data.landmarks.map(item => ({ ...item, isEditing: false }));
                const maxLId = landmarks.value.length > 0 ? Math.max(...landmarks.value.map(l => l.id)) : 0;
                nextLandmarkId = maxLId + 1;
                
                // 3. è¼‰å…¥è¨˜å¸³ (Expenses)
                expenses.value = data.expenses || [];
                
                // 4. è¼‰å…¥é¡˜æœ›æ¸…å–® (Wishlist)
                wishlist.value = data.wishlist || [];
                const maxWId = wishlist.value.length > 0 ? Math.max(...wishlist.value.map(w => w.id)) : 0;
                nextWishId = maxWId + 1;

                console.log("âœ… è³‡æ–™å¾ Firestore è¼‰å…¥æˆåŠŸï¼");
            })
            .catch(error => {
                console.error("è®€å– Firestore å¤±æ•—:", error);
            });
    }

    // å„²å­˜æ‰€æœ‰è³‡æ–™åˆ° Firestore (æ‰€æœ‰ç™»å…¥è€…çš†å¯å¯«å…¥)
    function saveAllDataToFirestore() {
        if (!user.value) {
             console.warn("æœªç™»å…¥ï¼Œç„¡æ³•å¯«å…¥è³‡æ–™ã€‚");
             return;
        }
        
        const cleanSchedule = schedule.value.map(({ isEditing, ...rest }) => rest);
        const cleanLandmarks = landmarks.value.map(({ isEditing, ...rest }) => rest);

        db.collection('groups').doc(GROUP_ID).set({
            schedule: cleanSchedule,
            landmarks: cleanLandmarks,
            expenses: expenses.value, 
            wishlist: wishlist.value
        }, { merge: true }) 
        .then(() => {
            console.log("ğŸ’¾ è³‡æ–™åŒæ­¥åˆ°é›²ç«¯æˆåŠŸï¼");
        })
        .catch((error) => {
            console.error("å¯«å…¥ Firestore å¤±æ•—:", error);
        });
    }

    // -------------------------------------------------------
    // Vue App å•Ÿå‹•é‚è¼¯ 
    // -------------------------------------------------------

    let nextScheduleId = 4;
    let nextLandmarkId = 4;
    let nextWishId = 2; 

    createApp({
        setup() {
            const currentTab = ref('itinerary'); 
            const user = ref(null); // é›²ç«¯ç™»å…¥ç‹€æ…‹
            const isLoggedIn = computed(() => user.value !== null);
            
            // --- ç™»å…¥/ç™»å‡ºåŠŸèƒ½ (è‡ªå‹•åŒ¿åç™»å…¥) ---
            
            // ç›£è½ç™»å…¥ç‹€æ…‹ä¸¦è§¸ç™¼è³‡æ–™è¼‰å…¥
            auth.onAuthStateChanged((currentUser) => {
                if (currentUser) {
                    user.value = currentUser;
                    loadAllDataFromFirestore(); 
                } else {
                    // å¦‚æœæ²’æœ‰ç”¨æˆ¶ï¼Œå‰‡è§¸ç™¼åŒ¿åç™»å…¥
                    auth.signInAnonymously()
                        .then((result) => {
                            user.value = result.user; // result.user æ˜¯åŒ¿åç”¨æˆ¶
                            loadAllDataFromFirestore();
                        })
                        .catch((error) => {
                            console.error("åŒ¿åç™»å…¥å¤±æ•—:", error);
                        });
                }
            });


            // --- æ•¸æ“šçµæ§‹ (Ref) ---
            const schedule = ref([]);
            const newScheduleItem = ref({ date: '', tag: '', desc: '' });
            
            const landmarks = ref([]);
            const newLandmarkItem = ref({ name: '', type: '', desc: '' });
            
            const expenses = ref([]);
            const newExpense = ref({ item: '', amount: null, method: 'ç¾é‡‘' });
            
            const members = ['çˆ¸çˆ¸', 'åª½åª½', 'æ©å®œ', 'æŸå‘ˆ', 'å”æ²›'];
            const wishlist = ref([]);
            const selectedMember = ref('å…¨éƒ¨'); 
            const newWishItem = ref({ member: 'æ©å®œ', item: '' }); 

            // =======================================================
            // ğŸš© æ•¸æ“šè®Šå‹•ç›£è½å™¨ï¼šè³‡æ–™è®Šå‹•æ™‚ï¼Œè‡ªå‹•åŒæ­¥åˆ°é›²ç«¯ ğŸš©
            // =======================================================

            const watchOptions = { deep: true };

            // æ‰€æœ‰è³‡æ–™çš„è®Šå‹•éƒ½æœƒè§¸ç™¼ saveAllDataToFirestore
            watch(schedule, () => { if (isLoggedIn.value) saveAllDataToFirestore(); }, watchOptions);
            watch(landmarks, () => { if (isLoggedIn.value) saveAllDataToFirestore(); }, watchOptions);
            watch(expenses, () => { if (isLoggedIn.value) saveAllDataToFirestore(); }, watchOptions);
            watch(wishlist, () => { if (isLoggedIn.value) saveAllDataToFirestore(); }, watchOptions);


            // --- è¡Œç¨‹ç®¡ç† CRUD ---
            function addScheduleItem() {
                if (newScheduleItem.value.date && newScheduleItem.value.desc && isLoggedIn.value) {
                    schedule.value.push({
                        id: nextScheduleId++,
                        date: newScheduleItem.value.date,
                        tag: newScheduleItem.value.tag || 'è¡Œç¨‹',
                        desc: newScheduleItem.value.desc,
                        isEditing: false
                    });
                    newScheduleItem.value = { date: '', tag: '', desc: '' };
                }
            }

            function toggleEdit(item) { if(isLoggedIn.value) item.isEditing = !item.isEditing; }
            function deleteScheduleItem(id) { 
                if(isLoggedIn.value) schedule.value = schedule.value.filter(item => item.id !== id);
            }

            // --- æ™¯é»ç®¡ç† CRUD ---
            function addLandmarkItem() {
                if (newLandmarkItem.value.name && isLoggedIn.value) {
                    landmarks.value.push({
                        id: nextLandmarkId++,
                        name: newLandmarkItem.value.name,
                        type: newLandmarkItem.value.type || 'æ™¯é»',
                        desc: newLandmarkItem.value.desc || '',
                        isEditing: false
                    });
                    newLandmarkItem.value = { name: '', type: '', desc: '' };
                }
            }
            function toggleLandmarkEdit(item) { if(isLoggedIn.value) item.isEditing = !item.isEditing; }
            function deleteLandmarkItem(id) { 
                if(isLoggedIn.value) landmarks.value = landmarks.value.filter(item => item.id !== id);
            }

            // --- è¨˜å¸³ ---
            const totalExpense = computed(() => expenses.value.reduce((sum, exp) => sum + exp.amount, 0));
            function addExpense() {
                if (newExpense.value.item && newExpense.value.amount && isLoggedIn.value) {
                    expenses.value.unshift({ ...newExpense.value });
                    newExpense.value = { item: '', amount: null, method: 'ç¾é‡‘' };
                }
            }

            // --- é¡˜æœ›æ¸…å–® ---
            const filteredWishlist = computed(() => {
                if (selectedMember.value === 'å…¨éƒ¨') {
                    return [...wishlist.value].sort((a, b) => members.indexOf(a.member) - members.indexOf(b.member));
                }
                return wishlist.value.filter(item => item.member === selectedMember.value);
            });
            function addWishItem() {
                if (newWishItem.value.item && newWishItem.value.member && isLoggedIn.value) {
                    wishlist.value.push({ 
                        id: nextWishId++,
                        member: newWishItem.value.member,
                        item: newWishItem.value.item, 
                        done: false 
                    });
                    newWishItem.value.item = ''; 
                    selectedMember.value = newWishItem.value.member;
                }
            }

            return { 
                currentTab, user, signInWithGoogle: () => {}, signOut: () => {}, isLoggedIn, // ç™»å…¥/ç™»å‡ºåŠŸèƒ½è¢«æ›¿æ›
                // è¡Œç¨‹
                schedule, newScheduleItem, addScheduleItem, toggleEdit, deleteScheduleItem,
                // æ™¯é»
                landmarks, newLandmarkItem, addLandmarkItem, toggleLandmarkEdit, deleteLandmarkItem,
                // è¨˜å¸³
                expenses, newExpense, totalExpense, addExpense, 
                // é¡˜æœ›æ¸…å–®
                members, selectedMember, wishlist, filteredWishlist, newWishItem, addWishItem
            };
        }
    }).mount('#app');
</script>
</body>
</html>