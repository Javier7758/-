<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025-2026 è·¨å¹´æ—…è¡Œ | æœ¬åœ°å„²å­˜ç‰ˆ (æ¥µç°¡)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .tab-active { color: #ff0000; border-bottom: 2px solid #ff0000; }
        .fa-solid { margin-right: 5px; } 

        /* ã€é¦™æ¸¯èƒŒæ™¯ï¼šç´«è‰²ç³»ã€‘ */
        .card-bg-HK { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), 
            url('https://dummyimage.com/600x80/6a0dad/ffffff&text=Hong+Kong'); /* ç´«è‰² */
            background-size: cover; 
            background-position: center;
        }
        
        /* æ·±åœ³èƒŒæ™¯ï¼šç¶ è‰²ç³» */
        .card-bg-SZ { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), url('https://dummyimage.com/600x80/004d40/ffffff&text=Shenzhen'); /* æ·±ç¶ è‰² */
            background-size: cover; 
            background-position: center;
        }

        /* ã€å»£å·èƒŒæ™¯ï¼šè—è‰²ç³»ã€‘ */
        .card-bg-GZ { 
            background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.4)), url('https://dummyimage.com/600x80/1a73e8/ffffff&text=Guangzhou'); /* è—è‰² */
            background-size: cover; 
            background-position: center;
        }

        .card-bg-default {
            background-color: #374151; /* slate-700 fallback */
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            text-align: right;
            margin-left: auto;
            /* ä¿®æ­£ï¼šç‚ºå¤©æ°£å€å¢åŠ ä¸€äº›å·¦é‚Šè·ï¼Œç¢ºä¿ä¸èˆ‡åŸå¸‚åç¨±é‡ç–Š */
            padding-left: 8px; 
        }

        /* æ™¯é»é€£çµæ¨£å¼ */
        .detail-link {
            font-weight: bold;
            color: #1a73e8; /* è—è‰² */
            transition: color 0.15s;
        }
        .detail-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="app" class="max-w-md mx-auto min-h-screen pb-4 relative shadow-2xl bg-white">
        
        <header class="bg-slate-900 text-white p-4 rounded-b-3xl shadow-lg">
            <div class="flex justify-between items-start mb-1">
                <div>
                    <h1 class="text-xl font-bold italic">è·¨å¹´æ—…è¡Œ <span class="text-orange-500">2025-2026</span></h1>
                    <p class="text-xs opacity-75">æ•¸æ“šå·²å„²å­˜æ–¼æ‚¨çš„è£ç½®ï¼Œç„¡éœ€ç™»å…¥</p>
                </div>
                
                <div class="text-right text-sm">
                    <p class="font-bold text-orange-400">{{ currentFullDate }}</p>
                    <p class="font-light text-xl leading-none">{{ currentTime }}</p>
                    
                    <div v-if="todayHeaderWeather" class="flex items-center justify-end opacity-90 mt-1 space-x-1">
                        <i :class="getWeatherIcon(todayHeaderWeather.weather)" class="fa-solid text-yellow-300 text-sm"></i>
                        <span class="text-xs font-medium">{{ todayHeaderWeather.weather }}</span>
                        <span class="text-xs opacity-75">({{ todayHeaderWeather.city }})</span>
                    </div>
                    <div v-else class="h-4"></div> 
                </div>
            </div>
        </header>
        
        <nav class="flex justify-around bg-white border-b sticky top-0 z-10 text-slate-400 font-medium">
            <button @click="currentTab = 'itinerary'" :class="{'tab-active': currentTab === 'itinerary'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-calendar-days block text-lg mb-1"></i>è¡Œç¨‹</button>
            <button @click="currentTab = 'finance'" :class="{'tab-active': currentTab === 'finance'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-wallet block text-lg mb-1"></i>è¨˜å¸³</button>
            <button @click="currentTab = 'wishlist'" :class="{'tab-active': currentTab === 'wishlist'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-gift block text-lg mb-1"></i>é¡˜æœ›</button>
            
            <a href="https://www.gbaweather.net/tc/" target="_blank" class="py-4 flex-1 text-sm flex flex-col items-center justify-center text-slate-400 hover:text-orange-500 transition duration-150">
                <i class="fa-solid fa-cloud-sun block text-lg mb-1"></i>
                å¤©æ°£
            </a>
            
            <button @click="currentTab = 'essentials'" :class="{'tab-active': currentTab === 'essentials'}" class="py-4 flex-1 text-sm"><i class="fa-solid fa-bell block text-lg mb-1"></i>é‡è¦è³‡è¨Š</button>
        </nav>

        <main class="p-4">
            
            <section v-if="currentTab === 'itinerary'" class="space-y-4">
                
                <div class="bg-slate-200 p-4 rounded-2xl mb-4 shadow-inner">
                    <h3 class="font-bold text-slate-800 mb-2 flex justify-between items-center">
                        åŒ¯ç‡è¨ˆç®—æ©Ÿ (TWD) <i class="fa-solid fa-calculator"></i>
                    </h3>
                    <div class="flex gap-2 mb-3">
                        <input v-model.number="calculator.amount" type="number" placeholder="è¼¸å…¥é‡‘é¡" class="w-1/2 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        <select v-model="calculator.currency" class="w-1/2 p-3 border rounded-xl text-sm bg-white">
                            <option value="HKD">HKD (æ¸¯å¹£1:4)</option>
                            <option value="RMB">RMB (äººæ°‘å¹£1:4.4)</option>
                        </select>
                    </div>
                    <p v-if="calculator.amount > 0" class="text-center text-lg font-bold text-orange-700">
                        = ${{ calculatedTWD.toFixed(2) }} TWD
                    </p>
                    <p v-else class="text-center text-sm text-slate-500">
                        è«‹è¼¸å…¥é‡‘é¡ä»¥é–‹å§‹è¨ˆç®—
                    </p>
                </div>
                <div v-for="day in orderedSchedule" :key="day.id" @click="showDetails(day)" 
                    class="bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 hover:shadow-xl cursor-pointer relative"
                    :class="{
                        'ring-4 ring-red-500/70 shadow-2xl bg-yellow-50': day.isToday
                    }"> 
                    
                    <div v-if="day.isToday" class="absolute top-0 left-0 px-3 py-1 bg-red-600 text-white text-xs font-bold rounded-br-xl z-10">
                        ğŸ“Œ ä»Šæ—¥è¡Œç¨‹
                    </div>

                    <div :class="`card-bg-${day.city_code}`"
                        class="h-16 w-full flex justify-between items-center p-3 text-white">
                        
                        <span class="text-xl font-extrabold tracking-wider mr-2">{{ day.city }}</span>
                        
                        <div class="weather-info">
                            <i :class="getWeatherIcon(day.weather)" class="fa-solid mr-1 text-yellow-300 text-lg"></i>
                            <div class="flex flex-col items-end leading-none">
                                <span class="font-bold text-sm">{{ day.weather }}</span>
                                <span class="text-xs opacity-90">{{ day.temp }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-3 border-l-4 border-orange-500"> 
                        <span class="text-lg font-extrabold text-slate-800 block mb-1">{{ day.date }}</span>
                        <p class="text-sm text-slate-700 truncate">{{ day.desc }}</p>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'essentials'" class="space-y-6">
                
               <div class="bg-green-50 p-4 rounded-xl shadow-md border-l-4 border-green-500">
                    <h3 class="font-bold text-green-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-plane-departure mr-2"></i> èˆªç­è³‡è¨Š</h3>
                    <div class="space-y-2 text-sm">
                        <a href="https://booking.evaair.com/flyeva/eva/b2c/manage-your-trip/online-checked-in-login.aspx?lang=zh-tw" target="_blank" class="font-bold text-blue-700 hover:text-blue-500 hover:underline transition duration-150 block">
                            æŒ‰æ­¤æ–¼èµ·é£›å‰ 48 å°æ™‚å…§è¾¦ç†ç·šä¸Šå ±åˆ°
                        </a>
                        <hr class="border-green-300">
                        <p><span class="font-semibold text-slate-900">å»ç¨‹ (é•·æ¦®BR867):</span> 2026/01/01 (09:50 - 11:50)</p>
                        <p><span class="font-semibold text-slate-900">å›ç¨‹ (é•·æ¦®BR868):</span> 2026/01/04 (13:30 - 15:20)</p>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl shadow-md border-l-4 border-blue-500">
    <h3 class="font-bold text-blue-800 text-lg mb-3 flex items-center"><i class="fa-solid fa-house-user mr-2"></i> ä½å®¿åœ°å€</h3>

    <div class="mb-4 pb-3 border-b border-blue-200">
        <p class="font-bold text-base text-slate-900 mb-1">ğŸ‡¨ğŸ‡³ æ·±åœ³</p>
        
        <a href="https://tw.trip.com/hotels/shenzhen-hotel-detail-41520773/bangtuo-meinuo-executive-apartment/" target="_blank" class="font-bold text-orange-600 hover:text-orange-500 hover:underline transition duration-150 text-base block">
            é‚¦æ‹“ç¾è«¾è¡Œæ”¿å…¬å¯“ï¼ˆæ·±åœ³å‰æµ·å»£å ´åº—ï¼‰
        </a>
        
        <p class="text-xs text-slate-600 mt-1">
            å—å±±å€, æœˆäº®ç£å¤§é“1104è™Ÿä½³å…†æ¥­å‰æµ·å»£å ´äºŒæœŸBåº§5æ¨“506å®¤
        </p>
    
    </div>

    <div>
        <p class="font-bold text-base text-slate-900 mb-1">ğŸ‡­ğŸ‡° é¦™æ¸¯</p>
        
        <a href="https://tw.trip.com/hotels/hong-kong-hotel-detail-7114825/camlux-hotel/" target="_blank" class="font-bold text-orange-600 hover:text-orange-500 hover:underline transition duration-150 text-base block">
            é¦™æ¸¯å›ç«‹é£¯åº—
        </a>
        
        <p class="text-xs text-slate-600 mt-1">
            è§€å¡˜å€, ä¹é¾ç£å®å…‰é“15è™Ÿ
        </p>
        <a href="https://www.google.com/maps/place/%E5%90%9B%E7%AB%8B%E9%85%92%E5%BA%97/@22.3237639,114.2034422,17z/data=!3m1!4b1!4m9!3m8!1s0x34040132e4727759:0xaefe60d32380705b!5m2!4m1!1i2!8m2!3d22.3237639!4d114.2060171!16s%2Fg%2F11c5s98sdf?entry=ttu&g_ep=EgoyMDI1MTIwMi4wIKXMDSoASAFQAw%3D%3D" target="_blank" class="text-xs text-blue-600 font-semibold hover:underline mt-1 inline-block">åœ¨ Google åœ°åœ–ä¸ŠæŸ¥çœ‹ <i class="fa-solid fa-location-dot ml-1"></i></a>
    </div>
</div>

               <div class="bg-red-50 p-4 rounded-xl shadow-md border-l-4 border-red-500">
    <h3 class="font-bold text-red-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-phone-volume mr-2"></i> ç·Šæ€¥æ±‚åŠ©é›»è©±ï¼ˆé»æ“Šæ’¥å‡ºï¼‰</h3>
    <div class="flex justify-around text-sm font-medium">
        <a href="tel:999" class="text-center text-slate-700 hover:text-red-600 p-1 rounded-md transition duration-150">
            ğŸ‡­ğŸ‡° **é¦™æ¸¯ï¼š** <span class="font-black text-xl">999</span>
        </a>
        <a href="tel:110" class="text-center text-slate-700 hover:text-red-600 p-1 rounded-md transition duration-150">
            ğŸ‡¨ğŸ‡³ **ä¸­åœ‹å¤§é™¸ ï¼š** <span class="font-black text-xl">110</span>
        </a>
    </div>
</div>

<div class="bg-yellow-50 p-4 rounded-xl shadow-md border-l-4 border-yellow-500">
    <h3 class="font-bold text-yellow-800 text-lg mb-2 flex items-center"><i class="fa-solid fa-exclamation-circle mr-2"></i> æ—…éŠæ³¨æ„äº‹é …</h3>
    <ul class="list-disc list-inside text-sm space-y-1 text-slate-700">
        <li>**é›»æºï¼š** 220Véƒ¨åˆ†é›»å™¨éœ€ä½¿ç”¨è½‰æ¥é ­åŠè®Šå£“å™¨ã€‚</li>
        <li>**å…¥å¢ƒï¼š** ä¸å¯æ”œå¸¶åŠ ç†±ç…™åŠå¤šæ–¼19æ”¯é¦™ç…™å…¥å¢ƒ ã€‚</li>
        <li>**è­‰ä»¶ï¼š** è‹¥æœªéš¨èº«æ”œå¸¶èº«ä»½è­‰æ˜æ–‡ä»¶å±¬æ–¼é•æ³•</li>
    </ul>

</div>

            </section>

            <section v-if="currentTab === 'finance'">
                
                
                <div @click="openStatsModal" class="bg-slate-900 text-white p-4 rounded-2xl mb-4 shadow-lg cursor-pointer transition duration-150 hover:bg-slate-800">
                    <p class="text-xs opacity-70 flex justify-between items-center">
                        ç¸½æ”¯å‡º (TWD)
                        <i class="fa-solid fa-chart-pie text-base"></i>
                    </p>
                    <p class="text-2xl font-bold">TWD ${{ totalExpenseTWD.toFixed(0) }}</p>
                </div>

                <div class="space-y-2 mb-6 p-4 border border-dashed rounded-xl bg-orange-50">
                    <h4 class="font-bold text-slate-800 mb-2">æ–°å¢æ”¯å‡ºé …ç›®</h4>
                    
                    <div class="w-full">
                        <div v-if="newExpense.category === 'äº¤é€š' && newExpense.item !== 'å…¶ä»–äº¤é€š'">
                            <select v-model="newExpense.item" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="">è«‹é¸æ“‡äº¤é€šæ–¹å¼ (éå¿…å¡«)</option>
                                <option value="å·´å£«">å·´å£«</option>
                                <option value="åœ°éµ">åœ°éµ</option>
                                <option value="çš„å£«">çš„å£«</option>
                                <option value="è·¨å¢ƒäº¤é€š">è·¨å¢ƒäº¤é€š</option>
                                <option value="å…¶ä»–äº¤é€š">å…¶ä»–</option>
                            </select>
                        </div>
                        <div v-else-if="newExpense.category === 'äº¤é€š' && newExpense.item === 'å…¶ä»–äº¤é€š'">
                               <input v-model="newExpense.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div v-else>
                            <input v-model="newExpense.item" placeholder="ç°¡è¿° (éå¿…å¡«)" class="w-full p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                            <select v-model="newExpense.category" class="flex-1 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="åƒå–">åƒå–</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="è³¼ç‰©">è³¼ç‰©</option>
                                <option value="é–€ç¥¨">é–€ç¥¨</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-3 border rounded-xl text-sm focus:ring-orange-500 focus:border-orange-500">
                            <select v-model="newExpense.currency" class="w-20 p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                                <option value="HKD">HKD</option>
                                <option value="RMB">RMB</option>
                                <option value="TWD">TWD</option>
                            </select>
                    </div>

                    <select v-model="newExpense.method" class="w-full p-3 border rounded-xl text-sm bg-white focus:ring-orange-500 focus:border-orange-500">
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        <option value="å…«é”é€š">å…«é”é€š</option>
                        <option value="é›»å­æ”¯ä»˜">é›»å­æ”¯ä»˜</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                    <button @click="addExpense" :disabled="!newExpense.amount" class="w-full bg-orange-500 disabled:opacity-50 text-white p-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢æ”¯å‡º</button>
                </div>

                <div v-for="(exp, index) in expenses" :key="exp.id" class="p-3 border-b border-slate-200 hover:bg-slate-50 transition duration-100">
                    <div v-if="!exp.isEditing" class="flex justify-between items-start text-sm">
                        <div class="flex-1">
                            <span class="font-bold text-slate-800">{{ exp.item }}</span>
                            <small class="text-slate-400 block">{{ getCategoryLabel(exp.category) }} ({{ exp.method }})</small>
                        </div>
                        <div class="text-right">
                            <span class="font-medium text-red-500 text-base block">- {{ exp.currency }} {{ exp.amount }}</span>
                            <span v-if="exp.currency !== 'TWD'" class="text-xs text-slate-500">
                                (ç´„ TWD {{ convertToTWD(exp.amount, exp.currency).toFixed(0) }})
                            </span>
                            <div class="flex justify-end gap-3 pt-1 mt-1">
                                <button @click="toggleEdit(exp)" class="text-xs text-blue-500 hover:text-blue-700 font-medium"><i class="fa-solid fa-edit mr-1"></i>ç·¨è¼¯</button>
                                <button @click="deleteExpense(exp.id)" class="text-xs text-red-500 hover:text-red-700 font-medium"><i class="fa-solid fa-trash-alt mr-1"></i>åˆªé™¤</button>
                            </div>
                        </div>
                    </div>

                    <div v-else class="p-2 bg-white rounded-lg border border-blue-300">
                            <h4 class="font-bold text-sm mb-2 text-blue-600">ç·¨è¼¯æ”¯å‡º</h4>
                            
                            <div v-if="exp.category === 'äº¤é€š' && exp.item === 'å…¶ä»–äº¤é€š'">
                                 <input v-model="exp.item" placeholder="è«‹è¼¸å…¥äº¤é€šç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div v-else-if="exp.category === 'äº¤é€š'">
                                 <select v-model="exp.item" class="w-full p-2 border rounded-lg text-sm mb-2 bg-white focus:ring-blue-500 focus:border-blue-500">
                                     <option value="å·´å£«">å·´å£«</option>
                                     <option value="åœ°éµ">åœ°éµ</option>
                                     <option value="çš„å£«">çš„å£«</option>
                                     <option value="è·¨å¢ƒäº¤é€š">è·¨å¢ƒäº¤é€š</option>
                                     <option value="å…¶ä»–äº¤é€š">å…¶ä»–</option>
                                 </select>
                            </div>
                            <div v-else>
                                 <input v-model="exp.item" placeholder="ç°¡è¿°" class="w-full p-2 border rounded-lg text-sm mb-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <div class="flex gap-2 mb-2">
                                 <select v-model="exp.category" class="flex-1 p-2 border rounded-lg text-sm bg-white">
                                     <option value="åƒå–">åƒå–</option>
                                     <option value="äº¤é€š">äº¤é€š</option>
                                     <option value="è³¼ç‰©">è³¼ç‰©</option>
                                     <option value="é–€ç¥¨">é–€ç¥¨</option>
                                     <option value="å…¶ä»–">å…¶ä»–</option>
                                 </select>
                                 <input v-model.number="exp.amount" type="number" placeholder="é‡‘é¡" class="w-1/3 p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                  <select v-model="exp.currency" class="w-1/4 p-2 border rounded-lg text-sm bg-white">
                                      <option value="HKD">HKD</option>
                                      <option value="RMB">RMB</option>
                                      <option value="TWD">TWD</option>
                                  </select>
                            </div>
                            <select v-model="exp.method" class="w-full p-2 border rounded-lg text-sm mb-3 bg-white">
                                 <option value="ç¾é‡‘">ç¾é‡‘</option>
                                 <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                                 <option value="å…«é”é€š">å…«é”é€š</option>
                                 <option value="é›»å­æ”¯ä»˜">é›»å­æ”¯ä»˜</option>
                                 <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>

                            <button @click="toggleEdit(exp)" class="w-full bg-blue-600 text-white p-2 rounded-xl font-bold active:scale-95 transition">
                                     å„²å­˜ä¿®æ”¹ <i class="fa-solid fa-save ml-1"></i>
                            </button>
                    </div>
                </div>
            </section>

            <section v-if="currentTab === 'wishlist'" class="space-y-4">
                <div class="mb-4">
                    <select v-model="selectedMember" class="w-full p-3 border border-orange-300 rounded-xl text-sm font-bold bg-white shadow-md focus:ring-2 focus:ring-orange-500">
                        <option value="å…¨éƒ¨">æ‰€æœ‰äºº (é¡¯ç¤ºæ‰€æœ‰é¡˜æœ›)</option>
                        <option v-for="member in members" :key="member" :value="member">{{ member }}</option>
                    </select>
                </div>

                <div class="flex gap-2 mb-6">
                    <select v-model="newWishItem.member" class="p-3 border rounded-xl text-sm bg-white font-medium">
                        <option v-for="member in members" :key="member + '_add'" :value="member">{{ member }}</option>
                    </select>
                    <input v-model="newWishItem.item" @keyup.enter="addWishItem" placeholder="æƒ³è²·ä»€éº¼..." class="flex-1 p-3 border rounded-lg text-sm focus:ring-orange-500 focus:border-orange-500">
                    <button @click="addWishItem" class="bg-slate-900 text-white px-4 rounded-xl active:scale-95 transition"><i class="fa-solid fa-plus"></i></button>
                </div>

                <div v-if="filteredWishlist.length > 0" class="space-y-2">
                    <div v-for="(item, index) in filteredWishlist" :key="item.id" class="flex items-center p-3 bg-slate-50 rounded-xl justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" v-model="item.done" class="mr-3 w-5 h-5 accent-orange-500">
                            <span :class="{'line-through text-slate-400': item.done}" class="text-sm font-medium">{{ item.item }}</span>
                        </div>
                        <span v-if="selectedMember === 'å…¨éƒ¨'" class="text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full">{{ item.member }}</span>
                        
                        <button @click="deleteWishItem(item.id)" class="ml-3 text-red-500 hover:text-red-700">
                            <i class="fa-solid fa-times text-xs"></i>
                        </button>
                    </div>
                </div>
                <div v-else class="text-center text-slate-500 p-8 border border-dashed rounded-xl">
                    <i class="fa-solid fa-face-frown text-2xl mb-2"></i>
                    <p>{{ selectedMember }} çš„é¡˜æœ›æ¸…å–®æ˜¯ç©ºçš„ï¼</p>
                </div>
            </section>

        </main>
        
        <div v-if="isStatsModalOpen" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex justify-center items-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-sm">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-xl font-bold text-slate-800">æ”¯å‡ºåˆ†æ (TWD)</h3>
                    <button @click="isStatsModalOpen = false" class="text-gray-500 hover:text-gray-800">
                        <i class="fa-solid fa-times text-lg"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="w-full h-64 flex justify-center">
                        <canvas id="expenseChart"></canvas>
                    </div>

                    <h4 class="font-bold text-sm text-orange-600 mt-4">ç¸½æ”¯å‡º TWD ${{ totalExpenseTWD.toFixed(0) }}</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div v-for="(amount, category) in categoryTotals" :key="category" class="flex justify-between border-b pb-1">
                            <span>{{ category }}</span>
                            <span class="font-medium text-slate-700">TWD {{ amount.toFixed(0) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="isDetailModalOpen && selectedDayDetails" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex justify-center items-center z-50 p-4">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-xl font-bold text-slate-800">
                        {{ selectedDayDetails.city }} - {{ selectedDayDetails.date }} è©³æƒ…
                    </h3>
                    <button @click="isDetailModalOpen = false" class="text-gray-500 hover:text-gray-800">
                        <i class="fa-solid fa-times text-lg"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <p class="text-sm text-slate-600 mb-4">{{ selectedDayDetails.summary }}</p>
                    
                    <h4 class="font-bold text-orange-600 text-lg border-b pb-1 mb-3">ç•¶æ—¥è¡Œç¨‹é»</h4>
                    
                    <div v-for="(item, index) in selectedDayDetails.details" :key="index" class="p-3 border-l-4 border-slate-200 hover:bg-slate-50 transition duration-150">
                        <p class="font-bold text-slate-800 mb-1 flex items-start text-sm">
                            <i class="fa-solid fa-location-dot mr-2 mt-1 text-orange-500 flex-shrink-0"></i> 
                            <span class="flex-grow">
                                <span v-if="item.time" class="text-slate-500 font-normal mr-1">{{ item.time }}:</span>
                                
                                <a v-if="item.link" :href="item.link" target="_blank" class="detail-link">
                                    {{ item.name }} 
                                    <i class="fa-solid fa-external-link-alt text-xs ml-1"></i>
                                </a>
                                <span v-else class="font-medium">{{ item.name }}</span>
                            </span>
                        </p>
                        <p v-if="item.note" class="text-xs text-slate-500 ml-5">{{ item.note }}</p>
                    </div>

                    <div class="text-center pt-4">
                           <button @click="isDetailModalOpen = false" class="w-full bg-slate-200 text-slate-800 p-2 rounded-xl font-bold hover:bg-slate-300 transition">
                                 é—œé–‰
                           </button>
                    </div>
                </div>
            </div>
        </div>


    </div>
<script>
    const { createApp, ref, computed, watch, nextTick } = Vue;

    // --- Local Storage åŠ©æ‰‹å‡½å¼ï¼šè®€å–èˆ‡å„²å­˜é€šç”¨é‚è¼¯ ---

    function loadData(key, defaultData = []) {
        try {
            const stored = localStorage.getItem(key);
            const data = stored ? JSON.parse(stored) : defaultData;
            
            if (key === 'hk_trip_expenses') {
                return data.map(item => ({ 
                    id: item.id || Date.now() + Math.random(), 
                    category: item.category || 'å…¶ä»–', 
                    isEditing: item.isEditing || false, 
                    item: item.item || '', 
                    ...item 
                }));
            }
            return data;
        } catch (e) {
            console.error(`ç„¡æ³•å¾ Local Storage è®€å–è³‡æ–™: ${key}`, e);
            return defaultData;
        }
    }

    function saveData(key, list) {
        // å„²å­˜å‰ç§»é™¤ UI ç‹€æ…‹ï¼ˆisEditingï¼‰
        const cleanedList = list.map(({ isEditing, ...rest }) => rest);
        localStorage.setItem(key, JSON.stringify(cleanedList));
    }

    // =======================================================
    // ğŸ’¡ è¼”åŠ©å‡½å¼ï¼šå°‡ 'MM/DD' è½‰æ›ç‚ºå¸¶æœ‰æ­£ç¢ºå¹´ä»½çš„ Date ç‰©ä»¶ ğŸ’¡
    // =======================================================
    function getComparableDate(dateString) {
        const [month, day] = dateString.split('/').map(Number);
        
        let year = 2025; // é è¨­å¹´ä»½ç‚º 2025
        
        // ** ä¿®æ­£å¹´ä»½åˆ¤æ–·é‚è¼¯ï¼šè·¨ 2025/2026 å¹´ **
        // å¦‚æœæœˆä»½æ˜¯ 1 æœˆï¼ˆå³ 01/xxï¼‰ï¼Œå‰‡å¹´ä»½ç‚º 2026
        if (month >= 1 && month <= 6) { // è¡Œç¨‹æœ€æ™šåˆ° 01/04
            year = 2026;
        } else if (month === 12) { // 12/25 ~ 12/31
            year = 2025;
        } 
        
        // æ³¨æ„ï¼šæœˆä»½åœ¨ JS ä¸­å¾ 0 (ä¸€æœˆ) é–‹å§‹ï¼Œæ‰€ä»¥è¦æ¸› 1
        return new Date(year, month - 1, day);
    }
    
    // -------------------------------------------------------
    // Vue App å•Ÿå‹•å‰çš„æ•¸æ“šè™•ç† 
    // -------------------------------------------------------

    // ğŸš© æ•¸æ“šä¿®æ”¹å€ï¼šè¡Œç¨‹èˆ‡æ™¯é» ğŸš©
    // ** æ­¤è™•å·²æ ¹æ“šç”¨æˆ¶çš„æœ€æ–°è¦æ±‚ (åŸå¸‚é †åºèˆ‡ä½å®¿å®‰æ’) é€²è¡Œäº†ä¿®æ”¹ **
    const FIXED_SCHEDULE = [
        // ----------------------------------------------------------------------
        // 12/25 - 12/31: ä½¿ç”¨ (1) é¦™æ¸¯çš„å®¶ ä½å®¿
        // ----------------------------------------------------------------------
        { 
            id: 1, date: '12/25', city: 'é¦™æ¸¯', city_code: 'HK', 
            desc: 'ã€è–èª•ç¯€ä¸»é¡Œã€‘å„è‡ªæŠµé”é¦™æ¸¯ã€å°–æ²™å’€æµ·æ¸¯åŸç‡ˆé£¾', 
            weather: 'æ™´æ™‚å¤šé›²', temp: '18Â°C / 13Â°C',
            summary: 'è–èª•ç¯€å…©äººå„è‡ªæŠµæ¸¯å¾Œæœƒåˆï¼Œå‰å¾€ä¹é¾å€æ„Ÿå—æ¿ƒåšçš„è–èª•æ°£æ°›å’Œç¶­æ¸¯å¤œæ™¯ã€‚',
            details: [
                { name: 'å¥³å‹èˆªç­ BR869 (TPE) æŠµæ¸¯', time: '14:20 HKT', note: 'å…©äººç´„åœ¨æ©Ÿå ´æœƒåˆ' },
                { name: 'æ‚¨çš„èˆªç­ CX423 (KHH) æŠµæ¸¯', time: '15:00 HKT', note: 'æœƒåˆå¾Œï¼Œå…ˆå›é¦™æ¸¯å®¶å®‰é “' },
                { name: 'å°–æ²™å’€ (Tsim Sha Tsui) æµ·æ¸¯åŸ/å»£æ±é“', time: '18:00', note: 'è§€è³è–èª•å¤§å‹ç‡ˆé£¾ä½ˆç½®èˆ‡ç¶­æ¸¯å¤œæ™¯' },
                { name: 'è–èª•æ™šé¤èˆ‡è³¼ç‰©', time: '20:00', note: 'åœ¨æµ·æ—æˆ–å•†å ´äº«ç”¨æ™šé¤' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        },
        { 
            id: 2, date: '12/26', city: 'æ·±åœ³', city_code: 'SZ', 
            desc: 'æ·±åœ³ä¸€æ—¥éŠï¼šè¯åƒ‘åŸå‰µæ„æ–‡åŒ–åœ’ï¼ˆæ–‡é’ã€ç¾é£Ÿï¼‰', 
            weather: 'æ™´æœ—', temp: '20Â°C / 15Â°C',
            summary: 'å‰å¾€æ·±åœ³é«”é©—è—è¡“æ°£æ¯å’Œæ–‡é’é¢¨æ ¼çš„åœ’å€ï¼Œä¸¦å“åšç•¶åœ°å°åƒã€‚',
            details: [
                { name: 'å¾é¦™æ¸¯å®¶å‡ºç™¼ï¼Œç¶“ç¾…æ¹–/ç¦ç”°å£å²¸å…¥å¢ƒæ·±åœ³', time: '09:00', note: 'å‰å¾€ç¾…æ¹–æˆ–ç¦ç”°å£å²¸' },
                { name: 'è¯åƒ‘åŸå‰µæ„æ–‡åŒ–åœ’ (OCT Loft)', time: '11:00', link: 'https://zh.wikipedia.org/wiki/%E5%8D%8E%E4%BE%A8%E5%9F%8E%E5%89%B5%E6%84%8F%E6%96%87%E5%8C%96%E5%9C%92' },
                { name: 'æ·±åœ³åˆé¤ï¼šåœ’å€é™„è¿‘ç°¡é¤', time: '13:30', note: 'å¯æ¢ç´¢åœ’å€å…§ç‰¹è‰²å’–å•¡å»³' },
                { name: 'ç¾…æ¹–/ç¦ç”°å£å²¸å‡ºå¢ƒå›æ¸¯', time: '18:00', note: 'è¿”å›é¦™æ¸¯çš„å®¶' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        },
        { 
            id: 3, date: '12/27', city: 'é¦™æ¸¯', city_code: 'HK', 
            desc: 'é›¢å³¶/æ–‡åŒ–ï¼šå—ä¸«å³¶æˆ–è¥¿ä¹æ–‡åŒ–å€ï¼ˆæ‚ é–’ã€è—è¡“ï¼‰', 
            weather: 'å¤šé›²', temp: '16Â°C / 11Â°C',
            summary: 'åœ¨ç·Šå¼µçš„è·¨å¹´å’Œå»£å·è¡Œå‰ï¼Œé¸æ“‡ä¸€è™•è¼•é¬†æ‚ é–’çš„åœ°é»æ”¾é¬†å¿ƒæƒ…ã€‚',
            details: [
                { name: 'é¸é …ä¸€ï¼šå—ä¸«å³¶ä¸€æ—¥éŠ', time: '10:00', note: 'ä¸­ç’°ç¢¼é ­æ­æ¸¡è¼ªï¼Œé©åˆå¥è¡Œå’Œæµ·é®®åˆé¤' },
                { name: 'é¸é …äºŒï¼šè¥¿ä¹æ–‡åŒ–å€è—è¡“å·¡ç¦®', time: '13:00', note: 'åƒè§€ M+ æˆ–æ•…å®®æ–‡åŒ–åšç‰©é¤¨ï¼Œé©åˆè—è¡“æ„›å¥½è€…' },
                { name: 'æ²¹éº»åœ°æ™šé¤èˆ‡å½Œæ•¦é“æ•£æ­¥', time: '19:30', note: 'å›å‘³åœ¨åœ°é¢¨å‘³' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        },
        // ----------------------------------------------------------------------
        // 12/28 - 12/29: ä½¿ç”¨ (2) å»£å·å¸Œå²¸é…’åº— ä½å®¿
        // ----------------------------------------------------------------------
        { 
            id: 4, date: '12/28', city: 'å»£å·', city_code: 'GZ', 
            desc: 'å»£å·ç¬¬ä¸€æ—¥ï¼šå»£å·å¡”ã€ç æ±Ÿå¤œéŠ (å…¥ä½å¸Œå²¸é…’åº—)', 
            weather: 'å¤§é›¨', temp: '15Â°C / 10Â°C',
            summary: 'å¾é¦™æ¸¯å‰å¾€å»£å·ï¼Œå…¥ä½é…’åº—å¾Œï¼Œé«”é©—å»£å·ç¾ä»£åœ°æ¨™èˆ‡ç æ±Ÿå¤œæ™¯ã€‚',
            details: [
                { name: 'å¾é¦™æ¸¯è¥¿ä¹é¾ç«™æ­ä¹˜é«˜éµè‡³å»£å·æ±ç«™/å—ç«™', time: '09:00', note: 'æ³¨æ„è·¨å¢ƒé«˜éµç­æ¬¡' },
                { name: 'å¸Œå²¸é…’åº—ï¼ˆå»£å·å¤©æ²³é«”è‚²ä¸­å¿ƒé«”è‚²è¥¿è·¯åœ°éµç«™åº—ï¼‰Check-in', time: '13:00', link: 'https://tw.trip.com/hotels/guangzhou-hotel-detail-67614747/xian-hotel/' },
                { name: 'è¶Šç§€å…¬åœ’æˆ–å¤©æ²³é«”è‚²ä¸­å¿ƒå•†åœˆ', time: '15:30', note: 'åœ¨é…’åº—é™„è¿‘æ´»å‹•' },
                { name: 'å»£å·å¡” (å°è »è…°) æˆ– ç æ±Ÿå¤œéŠ', time: '19:00', note: 'è§€è³ç æ±Ÿæ–°åŸå¤œæ™¯' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šå¸Œå²¸é…’åº—ï¼ˆå»£å·ï¼‰(2)'
        }, 
        { 
            id: 5, date: '12/29', city: 'å»£å·', city_code: 'GZ', 
            desc: 'å»£å·ç¬¬äºŒæ—¥ï¼šæ²™é¢å³¶ã€æ°¸æ…¶åŠã€åœ°é“ç²µå¼é»å¿ƒ', 
            weather: 'æ™´æ™‚å¤šé›²', temp: '16Â°C / 11Â°C',
            summary: 'åœ¨å»£å·è€åŸå€æ„Ÿå—æ­·å²ï¼Œå“åšåœ°é“çš„ç²µèœï¼Œå‚æ™šè¿”å›é¦™æ¸¯çš„å®¶ã€‚',
            details: [
                { name: 'æ²™é¢å³¶ç•°åœ‹å»ºç¯‰ç¾¤', time: '10:00', link: 'https://zh.wikipedia.org/wiki/%E6%B2%99%E9%9D%A2%E5%B3%B6' },
                { name: 'æ°¸æ…¶åŠ/è”æç£æ¹§èˆ‡åœ°é“ç²µå¼é»å¿ƒåˆé¤', time: '13:00', note: 'é«”é©—è¥¿é—œæ–‡åŒ–ï¼Œæ¨è–¦é™¶é™¶å±…' },
                { name: 'å¾å»£å·å‡ºç™¼ï¼Œæ­é«˜éµè¿”å›é¦™æ¸¯è¥¿ä¹é¾ç«™', time: '17:00', note: 'å¾é¦™æ¸¯è¥¿ä¹é¾ç«™è¿”å›é¦™æ¸¯çš„å®¶' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        }, 
        // ----------------------------------------------------------------------
        // 12/30 - 12/31: ä½¿ç”¨ (1) é¦™æ¸¯çš„å®¶ ä½å®¿
        // ----------------------------------------------------------------------
        { 
            id: 6, date: '12/30', city: 'æ·±åœ³', city_code: 'SZ', 
            desc: 'æ·±åœ³äºŒæ—¥éŠï¼šä¸–ç•Œä¹‹çª— æˆ– æ­¡æ¨‚æµ·å²¸ (è¿”å›é¦™æ¸¯å®¶)', 
            weather: 'å¤šé›²', temp: '19Â°C / 14Â°C',
            summary: 'å»£å·è¿”å›å¾Œï¼Œå‰å¾€æ·±åœ³é€²è¡Œç¬¬äºŒå¤©çš„æ·±åº¦æ¢ç´¢ï¼Œå¯é¸æ“‡ä¸»é¡Œæ¨‚åœ’æˆ–åŸå¸‚é¢¨æ™¯ã€‚',
            details: [
                { name: 'æ—©ä¸Šå¾é¦™æ¸¯çš„å®¶å‰å¾€æ·±åœ³ï¼ˆè·¨å¢ƒäº¤é€šï¼‰', time: '10:00', note: 'ä»Šæ—¥ä»æ˜¯å¾é¦™æ¸¯å¾€è¿”' },
                { name: 'ä¸–ç•Œä¹‹çª—ä¸»é¡Œæ¨‚åœ’ æˆ– æ·±åœ³ç£å…¬åœ’', time: '13:00', note: 'æ ¹æ“šåå¥½é¸æ“‡ï¼Œä¸–ç•Œä¹‹çª—è¼ƒè€—æ™‚' },
                { name: 'å‚æ™šï¼šå¾æ·±åœ³è¿”å›é¦™æ¸¯çš„å®¶', time: '19:00', note: 'ç‚ºæ˜æ—¥çš„è·¨å¹´å¤œåšæº–å‚™' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        },
        { 
            id: 7, date: '12/31', city: 'é¦™æ¸¯', city_code: 'HK', 
            desc: 'ã€é‡é»è¡Œç¨‹ã€‘ç¶­æ¸¯è·¨å¹´å€’æ•¸ï¼Œæº–å‚™è¿æ–°', 
            weather: 'æ™´æœ—', temp: '17Â°C / 12Â°C',
            summary: 'è·¨å¹´å¤œç•¶æ™šï¼Œåœ¨ç¶­å¤šåˆ©äºæ¸¯è¿æ–°ï¼Œæ¬£è³å£¯è§€çš„ç…™ç«è¡¨æ¼”ã€‚',
            details: [
                { name: 'è‡ªç”±æ´»å‹•ï¼Œåˆé¤èˆ‡ä¼‘æ¯ï¼Œæº–å‚™è·¨å¹´å¤œ', time: '14:00', note: 'ææ—©æº–å‚™ï¼Œé¿å…äººæ½®' },
                { name: 'å°–æ²™å’€/ç£ä»”æµ·æ—ä½”ä½', time: '19:00', note: 'å°‹æ‰¾æœ€ä½³è§€è³ç…™ç«ä½ç½®ï¼Œå¸¶ä¿æš–è¡£ç‰©' },
                { name: 'ç¶­å¤šåˆ©äºæ¸¯è·¨å¹´å€’æ•¸', time: '23:30', note: 'åˆå¤œ 12 é»ç…™ç«ç§€ (æ³¨æ„æ•£å ´äººæ½®)' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯çš„å®¶ (1)'
        },
        // ----------------------------------------------------------------------
        // 1/1 - 1/4: ä½¿ç”¨ (3) é¦™æ¸¯é£¯åº— ä½å®¿
        // ----------------------------------------------------------------------
        { 
            id: 8, date: '01/01', city: 'æ·±åœ³', city_code: 'SZ', 
            desc: 'ã€å›ºå®šè¡Œç¨‹ã€‘æ·±åœ³è¯å¼·åŒ—é›»å­å¸‚å ´ï¼Œå‚æ™šå…¥ä½é¦™æ¸¯é£¯åº—', 
            weather: 'å°é›¨', temp: '18Â°C / 13Â°C',
            summary: 'æ–°å¹´ç¬¬ä¸€å¤©ï¼Œå‰å¾€æ·±åœ³è¯å¼·åŒ—ï¼Œé€›é›»å­å¸‚å ´å°‹å¯¶ï¼Œä¸¦çµæŸåœ¨å®¶ä½å®¿ï¼Œæ”¹ä½é£¯åº—ã€‚',
            details: [
                { name: 'æ—©ä¸Šï¼šå¾é¦™æ¸¯çš„å®¶å‡ºç™¼å‰å¾€æ·±åœ³è¯å¼·åŒ—', time: '10:00', note: 'éå¢ƒå¾Œè½‰ä¹˜åœ°éµå‰å¾€' },
                { name: 'è¯å¼·åŒ—é›»å­å¸‚å ´', time: '12:00', link: 'https://zh.wikipedia.org/wiki/%E5%8D%8E%E5%BC%BA%E5%8C%97' },
                { name: 'è¯å¼·åŒ—å‘¨é‚Šåˆé¤', time: '14:00', note: 'åœ¨é›»å­å¸‚å ´å‘¨é‚Šç”¨é¤' },
                { name: 'å¾æ·±åœ³è¿”å›é¦™æ¸¯ï¼Œä¸¦å‰å¾€é¦™æ¸¯é£¯åº— Check-in', time: '18:00', note: 'å°‡è¡Œæè½‰ç§»è‡³é£¯åº—' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯é£¯åº— (3)'
        }, 
        { 
            id: 9, date: '01/02', city: 'é¦™æ¸¯', city_code: 'HK', 
            desc: 'ç¶“å…¸é¦™æ¸¯ï¼šå¤ªå¹³å±±é ‚ã€å±±é ‚çºœè»Šã€ä¸­ç’°', 
            weather: 'æ™´æ™‚å¤šé›²', temp: '17Â°C / 12Â°C',
            summary: 'å…¥ä½é£¯åº—å¾Œï¼Œæ¢ç´¢ä¸­ç’°å’Œå¤ªå¹³å±±é ‚çš„ç¶“å…¸åŸå¸‚æ™¯è§€ã€‚',
            details: [
                { name: 'ä¸­ç’°æ­·å²å»ºç¯‰ç¾¤/çŸ³æ¿è¡—', time: '10:00', note: 'å¾é£¯åº—å‡ºç™¼å‰å¾€ä¸­ç’°' },
                { name: 'åˆé¤ï¼šä¸­ç’°åœ°å€', time: '13:00', note: 'æ¢ç´¢ä¸­ç’°ç¾é£Ÿ' },
                { name: 'å±±é ‚çºœè»Šèˆ‡å¤ªå¹³å±±é ‚', time: '15:30', note: 'äº«å—ç¶­å¤šåˆ©äºæ¸¯å…¨æ™¯' },
                { name: 'è¿”å›é£¯åº—é™„è¿‘æ™šé¤', time: '19:30', note: 'äº«å—é£¯åº—å‘¨é‚Šè¨­æ–½' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯é£¯åº— (3)'
        },
        { 
            id: 10, date: '01/03', city: 'é¦™æ¸¯', city_code: 'HK', 
            desc: 'è³¼ç‰©/ç¾é£Ÿï¼šæ—ºè§’ã€æ²¹éº»åœ°ã€æ·±æ°´åŸ—ï¼ˆåœ¨åœ°ã€æ‡·èˆŠï¼‰', 
            weather: 'å¤šé›²', temp: '16Â°C / 11Â°C',
            summary: 'å‰å¾€ä¹é¾èˆŠå€ï¼Œæ„Ÿå—æœ€åœ°é“çš„é¦™æ¸¯ç”Ÿæ´»æ°£æ¯ï¼Œé©åˆè³¼ç‰©å’Œç™¼æ˜è¡—é ­å°åƒã€‚',
            details: [
                { name: 'æ·±æ°´åŸ—ï¼šé›»å­ç”¢å“èˆ‡æ‡·èˆŠå°åº—', time: '10:00', note: 'æ¢ç´¢é´¨å¯®è¡—é›»å­ç”¢å“æˆ–å¸ƒæ–™å¸‚å ´' },
                { name: 'æ—ºè§’ï¼šå¥³äººè¡—ã€æœ—è±ªåŠè³¼ç‰©', time: '13:00', note: 'åˆé¤å¯åœ¨æ—ºè§’è§£æ±º' },
                { name: 'æ²¹éº»åœ°ï¼šå»Ÿè¡—å¤œå¸‚ (æ™šé–“)', time: '18:00', note: 'é«”é©—å¤œå¸‚æ–‡åŒ–èˆ‡å¤§æ’æª”æ™šé¤' },
            ],
            accommodation_note: 'æ™šä¸Šä½ï¼šé¦™æ¸¯é£¯åº— (3)'
        },
        { 
            id: 11, date: '01/04', city: 'é¦™æ¸¯ (é›¢å¢ƒ)', city_code: 'HK', 
            desc: 'å›ç¨‹æ—¥ï¼šè‡ªç”±æ´»å‹•ã€å‰å¾€æ©Ÿå ´', 
            weather: 'æ™´æœ—', temp: '19Â°C / 14Â°C',
            summary: 'æ—…è¡Œçš„å°¾è²ï¼Œæœ€å¾Œçš„è‡ªç”±æ´»å‹•èˆ‡æ¡è³¼ï¼Œæº–å‚™å‰å¾€é¦™æ¸¯åœ‹éš›æ©Ÿå ´ã€‚',
            details: [
                { name: 'æœ€å¾Œçš„æ—©é¤æˆ–æ¡è³¼', time: '10:00', note: 'ä¾èˆªç­æ™‚é–“å½ˆæ€§èª¿æ•´' },
                { name: 'è¾¦ç†é€€æˆ¿æ‰‹çºŒ', time: '11:00', note: 'é›¢é–‹é¦™æ¸¯é£¯åº—' },
                { name: 'å‰å¾€é¦™æ¸¯åœ‹éš›æ©Ÿå ´ (HKIA)', time: 'æŒ‰é †åºæ’åˆ—', note: 'éœ€é ç•™å……è¶³äº¤é€šæ™‚é–“' },
                { name: 'é¦™æ¸¯å‡ºç™¼èˆªç­ï¼ˆå¾…è£œï¼‰', time: 'è«‹æä¾›å…·é«”å‡ºç™¼æ™‚é–“', note: 'åœ¨æ­¤å¡«å¯«èˆªç­è™Ÿå’Œæ™‚é–“' },
            ],
            accommodation_note: 'N/A'
        },
    ];
    
    // ** FIXED_MEMBERS ä¿æŒåŸç‹€ (ä¸ä¿®æ”¹) **
    const FIXED_MEMBERS = ['çˆ¸çˆ¸', 'åª½åª½', 'æ©å®œ', 'æŸå‘ˆ', 'å”æ²›']; 
    const defaultExpenses = []; 
    // ** defaultWishlist ä¿æŒåŸç‹€ (ä¸ä¿®æ”¹) **
    const defaultWishlist = [{ id: 1, member: 'æ©å®œ', item: 'å°ç†Šç¶­å°¼å…¬ä»”', done: false }];

    const initialExpenses = loadData('hk_trip_expenses', defaultExpenses);
    const initialWishlist = loadData('hk_trip_wishlist', defaultWishlist);

    let nextExpenseId = (initialExpenses.length > 0 ? Math.max(...initialExpenses.map(e => e.id)) : 0) + 1;
    let nextWishId = (initialWishlist.length > 0 ? Math.max(...initialWishlist.map(w => w.id)) : 0) + 1;

    // ğŸš© æ ¸å¿ƒåŒ¯ç‡å¸¸é‡ ğŸš©
    const RMB_RATE = 4.4; 
    const HKD_RATE = 4.0;
    
    const CHART_COLORS = [
        '#FF6384', '#36A2EB', '#FFCD56', '#4BC0C0', '#9966FF', '#FF9F40'
    ];
    let expenseChartInstance = null;
    
    // å¯¦æ™‚æ™‚é–“å’Œå¤©æ°£çš„éœæ…‹æ¨¡æ“¬æ•¸æ“š (æ‚¨éœ€æ‰‹å‹•æ›´æ”¹)
    const CURRENT_WEATHER_SIMULATION = {
        description: 'å¤šé›²æ™‚æ™´',
        iconClass: 'fa-cloud-sun' 
    };


    createApp({
        setup() {
            const currentTab = ref('itinerary'); 
            const isStatsModalOpen = ref(false); 
            const isDetailModalOpen = ref(false); 
            const selectedDayDetails = ref(null); Â 
            
            // ã€æ–°å¢ã€‘å¯¦æ™‚æ™‚é–“ç‹€æ…‹
            const currentDateTime = ref(new Date());

            // å®šæ™‚å™¨ï¼Œæ¯ç§’æ›´æ–°æ™‚é–“
            setInterval(() => {
                currentDateTime.value = new Date();
            }, 1000);
            
            // --- Computed Properties for Header ---
            const currentTime = computed(() => {
                return currentDateTime.value.toLocaleTimeString('zh-Hant', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            });

            const currentFullDate = computed(() => {
                return currentDateTime.value.toLocaleDateString('zh-Hant', { year: 'numeric', month: 'long', day: 'numeric' });
            });
            
            // ğŸš¨ ä¿®æ­£ï¼šå‹•æ…‹ç²å–ä»Šå¤©è¡Œç¨‹çš„å¤©æ°£è³‡è¨Š ğŸš¨
            const todayHeaderWeather = computed(() => {
                // æ‰¾å‡ºä»Šå¤©è¢«æ¨™è¨˜çš„è¡Œç¨‹
                const todayDay = orderedSchedule.value.find(day => day.isToday);
                
                if (todayDay) {
                    return {
                        city: todayDay.city.replace(' (ç•¶æ—¥å¾€è¿”)', '').replace(' (é›¢å¢ƒ)', ''), // æ¸…ç†åŸå¸‚åç¨±
                        weather: todayDay.weather,
                        temp: todayDay.temp
                    };
                }
                return null; // å¦‚æœæ²’æœ‰åŒ¹é…çš„æ—¥æœŸï¼Œå‰‡ä¸é¡¯ç¤º
            });


            const currentWeather = ref(CURRENT_WEATHER_SIMULATION);

            const getCurrentWeatherIcon = computed(() => {
                return currentWeather.value.iconClass;
            });

            
            // --- æ•¸æ“šçµæ§‹ (Ref) ---
            const schedule = ref(FIXED_SCHEDULE);
            const expenses = ref(initialExpenses);
            const newExpense = ref({ 
                item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒå–' 
            });
            const members = FIXED_MEMBERS;
            const wishlist = ref(initialWishlist);
            const selectedMember = ref('å…¨éƒ¨'); 
            const newWishItem = ref({ member: 'æ©å®œ', item: '' }); // ä¿æŒåŸç‹€
            const calculator = ref({ amount: null, currency: 'HKD' });


            // =======================================================
            // ğŸš© æ ¸å¿ƒé‚è¼¯å€ ğŸš©
            // =======================================================
            
            // ğŸ’¡ ä¿®æ­£ orderedSchedule: åš´æ ¼æŒ‰æ™‚é–“é †åºæ’åˆ— (ä¸å†æœ‰ç½®é ‚å’ŒæŠ˜ç–Šé‚è¼¯)
            const orderedSchedule = computed(() => {
                // ä½¿ç”¨ reactive çš„ currentDateTime.value ä¾†ç¢ºä¿è¨ˆç®—å±¬æ€§æœƒåœ¨æ™‚é–“æ›´æ–°æ™‚é‡æ–°è¨ˆç®—
                const now = currentDateTime.value;
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // ç²å–ç•¶å¤©åˆå¤œ

                return schedule.value
                    .map(day => {
                        const tripDate = getComparableDate(day.date);
                        
                        // æª¢æŸ¥æ˜¯å¦æ˜¯ä»Šå¤© (ç”¨æ–¼é«˜äº®é¡¯ç¤º)
                        const isToday = tripDate.getFullYear() === today.getFullYear() && 
                                                 tripDate.getMonth() === today.getMonth() && 
                                                 tripDate.getDate() === today.getDate();
                        
                        return { ...day, isToday: isToday, tripDate: tripDate };
                    })
                    .sort((a, b) => a.tripDate - b.tripDate); // åš´æ ¼æŒ‰æ™‚é–“é †åºæ’åº
            });


            // ğŸ’¡ æ ¹æ“šå¤©æ°£æè¿°è¿”å› Font Awesome åœ–ç¤º (è¡Œç¨‹å¡ç‰‡ç”¨)
            function getWeatherIcon(weather) {
                if (!weather) return 'fa-question-circle';
                if (weather.includes('æ™´') && !weather.includes('å¤šé›²')) return 'fa-sun'; 
                if (weather.includes('æ™´æ™‚å¤šé›²')) return 'fa-cloud-sun'; 
                if (weather.includes('é›¨') || weather.includes('å¤§é›¨')) return 'fa-cloud-rain';
                if (weather.includes('å¤šé›²') || weather.includes('é™°')) return 'fa-cloud';
                return 'fa-cloud-sun'; 
            }

            // ğŸ’¡ é¡¯ç¤ºè¡Œç¨‹è©³æƒ…å½ˆçª—
            function showDetails(day) {
                selectedDayDetails.value = day;
                isDetailModalOpen.value = true;
            }
            
            // ğŸ’° åŒ¯ç‡è½‰æ›å‡½å¼ (å¾ä»»ä½•å¹£åˆ¥è½‰ TWD)
            function convertToTWD(amount, currency) {
                amount = Number(amount) || 0;
                switch (currency) {
                    case 'RMB': return amount * RMB_RATE; 
                    case 'HKD': return amount * HKD_RATE; 
                    case 'TWD': return amount; 
                    default: return 0;
                }
            }
            
            // è¼”åŠ©å‡½å¼ï¼šæ ¹æ“š category ä»£ç¢¼ç²å–æ˜“è®€æ¨™ç±¤
            function getCategoryLabel(category) {
                if (!category) return 'ğŸ’¡ å…¶ä»–'; 
                
                switch (category) {
                    case 'åƒå–': return 'ğŸ½ï¸ åƒå–';
                    case 'äº¤é€š': return 'ğŸšŒ äº¤é€š';
                    case 'è³¼ç‰©': return 'ğŸ›ï¸ è³¼ç‰©';
                    case 'é–€ç¥¨': return 'ğŸŸï¸ é–€ç¥¨';
                    default: return 'ğŸ’¡ å…¶ä»–';
                }
            }


            // ğŸ’° åŒ¯ç‡è¨ˆç®—å±¬æ€§ (çµ¦ä¸Šæ–¹è¨ˆç®—æ©Ÿä½¿ç”¨)
            const calculatedTWD = computed(() => {
                return convertToTWD(calculator.value.amount, calculator.value.currency);
            });
            
            
            // --- è¨˜å¸³ CRUD ---
            
            // ğŸ¯ è¨ˆç®—å„åˆ†é¡ç¸½æ”¯å‡º (Computed Property)
            const categoryTotals = computed(() => {
                const totals = { 'åƒå–': 0, 'äº¤é€š': 0, 'è³¼ç‰©': 0, 'é–€ç¥¨': 0, 'å…¶ä»–': 0 };
                
                expenses.value.forEach(exp => {
                    const twdAmount = convertToTWD(exp.amount, exp.currency);
                    const mainCategoryKey = exp.category || 'å…¶ä»–'; 
                    
                    if (totals.hasOwnProperty(mainCategoryKey)) {
                        totals[mainCategoryKey] += twdAmount;
                    } else {
                        totals['å…¶ä»–'] += twdAmount;
                    }
                });
                return totals;
            });

            // è¨ˆç®—ç¸½æ”¯å‡º (Computed Property) - TWD ç¸½é¡
            const totalExpenseTWD = computed(() => {
                return expenses.value.reduce((total, exp) => {
                    return total + convertToTWD(exp.amount, exp.currency);
                }, 0);
            });
            
            // æ–°å¢æ”¯å‡ºå‡½å¼
            function addExpense() {
                // åƒ…æª¢æŸ¥é‡‘é¡æ˜¯å¦å¡«å¯«
                if (newExpense.value.amount) {
                    expenses.value.unshift({ 
                        ...newExpense.value, 
                        id: nextExpenseId++,
                        isEditing: false,
                        // è™•ç†ç°¡è¿°ï¼šå¦‚æœ item ç‚ºç©ºå­—ä¸²ï¼Œå°‡å…¶æ›¿æ›ç‚ºé¡åˆ¥åç¨±
                        item: newExpense.value.item || newExpense.value.category
                    });
                    
                    // é‡è¨­è¡¨å–®
                    newExpense.value = { item: '', amount: null, currency: 'HKD', method: 'ç¾é‡‘', category: 'åƒå–' };
                }
            }

            // ç·¨è¼¯/å„²å­˜åˆ‡æ›å‡½å¼
            function toggleEdit(item) { 
                item.isEditing = !item.isEditing; 
                // å¦‚æœæ˜¯å„²å­˜å‹•ä½œï¼Œç¢ºä¿ item ä¸ç‚ºç©º (çµ¦äºˆé¡åˆ¥åç¨±ä½œç‚ºé è¨­å€¼)
                if (!item.isEditing && !item.item) {
                        item.item = item.category;
                }
            }

            // åˆªé™¤æ”¯å‡ºå‡½å¼
            function deleteExpense(id) {
                expenses.value = expenses.value.filter(exp => exp.id !== id);
            }

            // ğŸŒŸ åœ“é¤…åœ–ç¹ªè£½é‚è¼¯ ğŸŒŸ
            function renderChart() {
                if (expenseChartInstance) {
                    expenseChartInstance.destroy(); 
                }

                const ctx = document.getElementById('expenseChart').getContext('2d');
                const totals = categoryTotals.value;
                
                const labels = Object.keys(totals).filter(key => totals[key] > 0);
                const data = labels.map(key => totals[key]);

                expenseChartInstance = new Chart(ctx, {
                    type: 'doughnut', 
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: CHART_COLORS.slice(0, labels.length),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: TWD ${value.toFixed(0)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // ğŸŒŸ æ‰“é–‹çµ±è¨ˆå½ˆçª—ä¸¦ç¹ªè£½åœ–è¡¨ ğŸŒŸ
            function openStatsModal() {
                isStatsModalOpen.value = true;
                nextTick(() => {
                    renderChart();
                });
            }
            
            // ğŸŒŸ ç›£è½æ–°æ”¯å‡ºé¡åˆ¥åˆ‡æ›ï¼Œæ¸…ç©ºç°¡è¿°ä»¥é¿å…æ®˜ç•™
            watch(() => newExpense.value.category, (newCategory) => {
                newExpense.value.item = ''; 
            });


            // --- é¡˜æœ›æ¸…å–® CRUD (ä¿æŒä¸è®Š) ---
            
            const filteredWishlist = computed(() => {
                if (!wishlist.value) return [];
                if (selectedMember.value === 'å…¨éƒ¨') {
                    // æª¢æŸ¥ members æ˜¯å¦ç‚ºç©ºï¼Œé¿å…åœ¨æ’åºæ™‚å´©æ½°
                    if (members.length === 0) return wishlist.value; 

                    return [...wishlist.value].sort((a, b) => {
                        const indexA = members.indexOf(a.member);
                        const indexB = members.indexOf(b.member);
                        return indexA - indexB;
                    });
                }
                return wishlist.value.filter(item => item.member === selectedMember.value);
            });
            
            function addWishItem() {
                if (newWishItem.value.item && newWishItem.value.member) {
                    wishlist.value.push({ 
                        id: nextWishId++,
                        member: newWishItem.value.member,
                        item: newWishItem.value.item, 
                        done: false 
                    });
                    newWishItem.value.item = ''; 
                    selectedMember.value = newWishItem.value.member;
                }
            }
            
            function deleteWishItem(id) {
                wishlist.value = wishlist.value.filter(item => item.id !== id);
            }
            
            // =======================================================
            // ğŸš© æ•¸æ“šè®Šå‹•ç›£è½å™¨ï¼šè‡ªå‹•å„²å­˜åˆ° Local Storage ğŸš©
            // =======================================================

            const watchOptions = { deep: true };
            watch(expenses, (newList) => saveData('hk_trip_expenses', newList), watchOptions);
            watch(wishlist, (newList) => saveData('hk_trip_wishlist', newList), watchOptions);


            return { 
                currentTab, 
                isStatsModalOpen, 
                isDetailModalOpen, 
                selectedDayDetails, 
                openStatsModal, 
                showDetails, 
                // è¡Œç¨‹
                schedule, orderedSchedule, getWeatherIcon, 
                // é ‚éƒ¨ Header æ™‚é–“/å¤©æ°£
                currentTime, currentFullDate, currentWeather, todayHeaderWeather, getCurrentWeatherIcon,
                // è¨˜å¸³
                expenses, newExpense, totalExpenseTWD, categoryTotals, addExpense, deleteExpense, toggleEdit, getCategoryLabel, convertToTWD,
                // åŒ¯ç‡è¨ˆç®—
                calculator, calculatedTWD,
                // é¡˜æœ›æ¸…å–®
                members, selectedMember, wishlist, filteredWishlist, newWishItem, addWishItem, deleteWishItem
            };
        }
    }).mount('#app');
</script>
</body>
</html>